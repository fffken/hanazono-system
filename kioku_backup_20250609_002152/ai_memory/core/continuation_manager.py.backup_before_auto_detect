"""
ğŸ§  kioku System - ProjectContinuationManager
Purpose: 15ç§’å®Œç’§ç¶™æ‰¿ã§ãã‚‹ä½œæ¥­ç¶™ç¶šè¨˜æ†¶æ©Ÿèƒ½
Enhanced: Gitè©³ç´°è¨˜éŒ² + è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå¯¾å¿œ
Created: 2025-06-04
"""

import json
import os
from datetime import datetime, timezone
from pathlib import Path
import subprocess

class ProjectContinuationManager:
    """ä½œæ¥­ç¶™ç¶šè¨˜æ†¶ç®¡ç†ã‚¯ãƒ©ã‚¹ - 15ç§’å®Œç’§ç¶™æ‰¿ã‚·ã‚¹ãƒ†ãƒ ï¼ˆå¼·åŒ–ç‰ˆï¼‰"""
    
    def __init__(self, project_name="hanazono"):
        self.project_name = project_name
        self.base_path = Path(f"ai_memory/storage/continuation/{project_name}")
        self.base_path.mkdir(parents=True, exist_ok=True)
        
        # ç¶™ç¶šè¨˜æ†¶ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
        self.phase_file = self.base_path / "current_phase.json"
        self.constraints_file = self.base_path / "technical_constraints.json"
        self.commands_file = self.base_path / "next_commands.json" 
        self.patterns_file = self.base_path / "success_patterns.json"
        self.handover_file = self.base_path / "15sec_handover_prompt.md"
        
        # åˆæœŸåŒ–
        self._initialize_files()
    
    @classmethod
    def list_projects(cls):
        """åˆ©ç”¨å¯èƒ½ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§å–å¾—"""
        continuation_root = Path("ai_memory/storage/continuation")
        if not continuation_root.exists():
            return []
        
        projects = []
        for project_dir in continuation_root.iterdir():
            if project_dir.is_dir():
                projects.append({
                    'name': project_dir.name,
                    'last_updated': project_dir.stat().st_mtime,
                    'has_phase': (project_dir / "current_phase.json").exists()
                })
        
        return sorted(projects, key=lambda x: x['last_updated'], reverse=True)
    
    @classmethod
    def get_latest_project(cls):
        """æœ€æ–°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—"""
        projects = cls.list_projects()
        if projects:
            return projects[0]['name']
        return "hanazono"  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
    
    def _initialize_files(self):
        """ç¶™ç¶šè¨˜æ†¶ãƒ•ã‚¡ã‚¤ãƒ«åˆæœŸåŒ–"""
        
        # current_phase.jsonåˆæœŸåŒ–
        if not self.phase_file.exists():
            initial_phase = {
                "timestamp": datetime.now(timezone.utc).isoformat(),
                "current_phase": "system_initialization",
                "phase_number": 1,
                "step": "setup",
                "progress_percentage": 0,
                "estimated_completion": "30_minutes",
                "description": f"kiokuã‚·ã‚¹ãƒ†ãƒ ç¶™ç¶šè¨˜æ†¶æ©Ÿèƒ½åˆæœŸåŒ– - {self.project_name}",
                "next_immediate_action": "ProjectContinuationManagerå®Ÿè£…"
            }
            self._save_json(self.phase_file, initial_phase)
        
        # technical_constraints.jsonåˆæœŸåŒ–
        if not self.constraints_file.exists():
            initial_constraints = {
                "timestamp": datetime.now(timezone.utc).isoformat(),
                "resolved_issues": [],
                "current_constraints": [
                    {
                        "constraint": "ä½œæ¥­æ–¹å¼é‰„å‰‡: éƒ¨åˆ†ä¿®æ­£ç¦æ­¢ã€å…¨ã‚³ãƒ”ãƒšåŸºæœ¬ã€éç ´å£Šçš„ä½œæ¥­å¾¹åº•",
                        "impact": "å…¨å®Ÿè£…ã§ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ç›´æ¥ã‚³ãƒ”ãƒš(30-40è¡Œ)ã¾ãŸã¯nanoå…¨ã‚³ãƒ”ãƒšã®ã¿ä½¿ç”¨",
                        "priority": "critical",
                        "recorded_at": datetime.now(timezone.utc).isoformat()
                    }
                ],
                "technical_decisions": []
            }
            self._save_json(self.constraints_file, initial_constraints)
        
        # next_commands.jsonåˆæœŸåŒ–
        if not self.commands_file.exists():
            initial_commands = {
                "timestamp": datetime.now(timezone.utc).isoformat(),
                "immediate_next": [f"python3 -c \"from ai_memory.core.continuation_manager import ProjectContinuationManager; cm=ProjectContinuationManager('{self.project_name}'); print('âœ… ç¶™ç¶šè¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†')\""],
                "phase_completion": [],
                "rollback_commands": []
            }
            self._save_json(self.commands_file, initial_commands)
        
        # success_patterns.jsonåˆæœŸåŒ–
        if not self.patterns_file.exists():
            initial_patterns = {
                "timestamp": datetime.now(timezone.utc).isoformat(),
                "successful_patterns": [],
                "failure_patterns": [],
                "best_practices": [
                    "å®Ÿè£…å‰å¿…ãšãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—",
                    "æ®µéšçš„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ",
                    "éç ´å£Šçš„ä½œæ¥­å¾¹åº•",
                    "éƒ¨åˆ†ä¿®æ­£ç¦æ­¢ãƒ»å…¨ã‚³ãƒ”ãƒšåŸºæœ¬"
                ]
            }
            self._save_json(self.patterns_file, initial_patterns)
    
    def save_work_snapshot(self, phase, step, progress, description, next_action):
        """ä½œæ¥­ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¿å­˜"""
        snapshot = {
            "timestamp": datetime.now(timezone.utc).isoformat(),
            "current_phase": phase,
            "phase_number": self._extract_phase_number(phase),
            "step": step,
            "progress_percentage": progress,
            "estimated_completion": self._estimate_completion(progress),
            "description": description,
            "next_immediate_action": next_action,
            "git_status": self._get_git_status_enhanced(),
            "active_files": self._get_active_files(),
            "project_name": self.project_name
        }
        
        self._save_json(self.phase_file, snapshot)
        print(f"ğŸ“¸ ä½œæ¥­ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¿å­˜: {phase} - {step} ({progress}%) [{self.project_name}]")
        return True
    
    def record_git_changes_detail(self):
        """Gitå¤‰æ›´è©³ç´°è¨˜éŒ²ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åˆ¥å·®åˆ†çµ±è¨ˆï¼‰"""
        try:
            result = subprocess.run(['git', 'diff', '--stat'], 
                                  capture_output=True, text=True, cwd='.')
            
            if result.stdout.strip():
                lines = result.stdout.strip().split('\n')
                file_changes = []
                for line in lines[:-1]:
                    if '|' in line:
                        parts = line.split('|')
                        filename = parts[0].strip()
                        changes = parts[1].strip() if len(parts) > 1 else ''
                        file_changes.append({'file': filename, 'changes': changes})
                
                summary_line = lines[-1] if lines else ''
                files_changed = len(file_changes)
                major_files = [f['file'] for f in file_changes[:5]]
                
                git_detail = {
                    'timestamp': datetime.now(timezone.utc).isoformat(),
                    'files_changed': files_changed,
                    'summary': summary_line,
                    'major_changes': major_files,
                    'file_details': file_changes[:10],
                    'change_scale': self._assess_change_scale(files_changed)
                }
                return git_detail
            else:
                return {'status': 'no_changes', 'files_changed': 0}
        except Exception as e:
            print(f"âš ï¸ Gitè©³ç´°è¨˜éŒ²ã‚¨ãƒ©ãƒ¼: {e}")
            return {'status': 'error', 'error': str(e)}
    
    def _assess_change_scale(self, files_changed):
        """å¤‰æ›´è¦æ¨¡è©•ä¾¡"""
        if files_changed >= 100:
            return "massive"
        elif files_changed >= 50:
            return "large"
        elif files_changed >= 20:
            return "medium"
        elif files_changed >= 5:
            return "small"
        else:
            return "minimal"
    
    def _get_git_status_enhanced(self):
        """GitçŠ¶æ…‹å–å¾—ï¼ˆè©³ç´°ç‰ˆï¼‰"""
        try:
            result = subprocess.run(['git', 'status', '--porcelain'], 
                                  capture_output=True, text=True, cwd='.')
            lines = result.stdout.strip().split('\n') if result.stdout.strip() else []
            
            git_detail = self.record_git_changes_detail()
            
            if git_detail.get('files_changed', 0) > 0:
                scale = git_detail.get('change_scale', 'unknown')
                major_files = git_detail.get('major_changes', [])
                major_str = ', '.join(major_files[:3])
                return f"{len(lines)} files changed ({scale}) - ä¸»è¦: {major_str}"
            else:
                return f"{len(lines)} files changed" if lines else "clean"
        except Exception as e:
            return "unknown"
    
    def generate_15sec_handover(self):
        """15ç§’ç¶™æ‰¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ"""
        try:
            # å„ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            phase_data = self._load_json(self.phase_file)
            constraints_data = self._load_json(self.constraints_file)
            commands_data = self._load_json(self.commands_file)
            patterns_data = self._load_json(self.patterns_file)
            
            # GitçŠ¶æ…‹å–å¾—
            git_status = self._get_git_status_enhanced()
            
            # 15ç§’ç¶™æ‰¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
            handover = f"""ğŸ§  **15ç§’å®Œç’§ç¶™æ‰¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ** - {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}

## âš¡ å³åº§å®Ÿè¡Œæƒ…å ±
```bash
cd ~/lvyuan_solar_control
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ: {self.project_name}
# ç¾åœ¨Phase: {phase_data.get('current_phase', 'unknown')}
# Progress: {phase_data.get('progress_percentage', 0)}%
# GitçŠ¶æ…‹: {git_status}
```

## ğŸš¨ é‡è¦åˆ¶ç´„ï¼ˆé‰„å‰‡ï¼‰
{self._format_constraints_enhanced(constraints_data)}

## ğŸ¯ ç¾åœ¨çŠ¶æ³
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: {self.project_name}
- **Phase**: {phase_data.get('current_phase', 'unknown')} (Step: {phase_data.get('step', 'unknown')})
- **é€²æ—**: {phase_data.get('progress_percentage', 0)}% å®Œäº†
- **èª¬æ˜**: {phase_data.get('description', 'No description')}
- **æ¬¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: {phase_data.get('next_immediate_action', 'TBD')}

## ğŸš€ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
```bash
{self._format_next_commands(commands_data)}
```

## ğŸ’¡ æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨
{self._format_success_patterns(patterns_data)}

## ğŸ”§ å³åº§å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰
```bash
{commands_data.get('immediate_next', ['# No immediate commands'])[0] if commands_data.get('immediate_next') else '# No commands available'}
```

## ğŸ“Š æŠ€è¡“çŠ¶æ³
- **GitçŠ¶æ…‹**: {git_status}
- **ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«**: {', '.join(self._get_active_files()[:3])}
- **æ¨å®šå®Œäº†**: {phase_data.get('estimated_completion', 'unknown')}

**ã“ã®ç¶™æ‰¿ã§å³åº§ã«ä½œæ¥­ç¶™ç¶šå¯èƒ½ï¼**
"""
            
            # ç¶™æ‰¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
            with open(self.handover_file, 'w', encoding='utf-8') as f:
                f.write(handover)
            
            print("âœ… 15ç§’ç¶™æ‰¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆå®Œäº†")
            print(f"ğŸ“„ ä¿å­˜å…ˆ: {self.handover_file}")
            return handover
            
        except Exception as e:
            print(f"âŒ ç¶™æ‰¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã‚¨ãƒ©ãƒ¼: {e}")
            return "ğŸš¨ ç¶™æ‰¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆå¤±æ•—"
    
    def record_technical_constraint(self, constraint, impact, priority="medium"):
        """æŠ€è¡“åˆ¶ç´„è¨˜éŒ²"""
        try:
            constraints_data = self._load_json(self.constraints_file)
            
            new_constraint = {
                "constraint": constraint,
                "impact": impact,
                "priority": priority,
                "recorded_at": datetime.now(timezone.utc).isoformat()
            }
            
            if "current_constraints" not in constraints_data:
                constraints_data["current_constraints"] = []
            
            constraints_data["current_constraints"].append(new_constraint)
            constraints_data["timestamp"] = datetime.now(timezone.utc).isoformat()
            
            self._save_json(self.constraints_file, constraints_data)
            print(f"ğŸ“ æŠ€è¡“åˆ¶ç´„è¨˜éŒ²: {constraint}")
            return True
            
        except Exception as e:
            print(f"âŒ åˆ¶ç´„è¨˜éŒ²ã‚¨ãƒ©ãƒ¼: {e}")
            return False
    
    def save_next_command(self, command_type, commands):
        """æ¬¡ã‚¹ãƒ†ãƒƒãƒ—ã‚³ãƒãƒ³ãƒ‰ä¿å­˜"""
        try:
            commands_data = self._load_json(self.commands_file)
            
            commands_data[command_type] = commands if isinstance(commands, list) else [commands]
            commands_data["timestamp"] = datetime.now(timezone.utc).isoformat()
            
            self._save_json(self.commands_file, commands_data)
            print(f"ğŸ’¾ æ¬¡ã‚¹ãƒ†ãƒƒãƒ—ã‚³ãƒãƒ³ãƒ‰ä¿å­˜: {command_type}")
            return True
            
        except Exception as e:
            print(f"âŒ ã‚³ãƒãƒ³ãƒ‰ä¿å­˜ã‚¨ãƒ©ãƒ¼: {e}")
            return False
    
    def mark_phase_complete(self, phase, success_factors=None):
        """Phaseå®Œäº†ãƒãƒ¼ã‚­ãƒ³ã‚°"""
        try:
            patterns_data = self._load_json(self.patterns_file)
            
            completion_record = {
                "pattern": f"{phase}_completion",
                "phase": phase,
                "completion_time": datetime.now(timezone.utc).isoformat(),
                "success_factors": success_factors or ["æ®µéšçš„å®Ÿè£…", "ãƒ†ã‚¹ãƒˆå®Œäº†"],
                "project": self.project_name
            }
            
            if "successful_patterns" not in patterns_data:
                patterns_data["successful_patterns"] = []
            
            patterns_data["successful_patterns"].append(completion_record)
            patterns_data["timestamp"] = datetime.now(timezone.utc).isoformat()
            
            self._save_json(self.patterns_file, patterns_data)
            print(f"ğŸ‰ Phaseå®Œäº†è¨˜éŒ²: {phase} [{self.project_name}]")
            return True
            
        except Exception as e:
            print(f"âŒ å®Œäº†è¨˜éŒ²ã‚¨ãƒ©ãƒ¼: {e}")
            return False
    
    def get_current_status(self):
        """ç¾åœ¨çŠ¶æ³å–å¾—"""
        phase_data = self._load_json(self.phase_file)
        return {
            "project": self.project_name,
            "phase": phase_data.get('current_phase', 'unknown'),
            "step": phase_data.get('step', 'unknown'),
            "progress": phase_data.get('progress_percentage', 0),
            "next_action": phase_data.get('next_immediate_action', 'TBD')
        }
    
    # Helper methods
    def _load_json(self, file_path):
        """JSONãƒ•ã‚¡ã‚¤ãƒ«å®‰å…¨èª­ã¿è¾¼ã¿"""
        try:
            if file_path.exists():
                with open(file_path, 'r', encoding='utf-8') as f:
                    return json.load(f)
            return {}
        except Exception as e:
            print(f"âš ï¸ JSONèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: {file_path} - {e}")
            return {}
    
    def _save_json(self, file_path, data):
        """JSONãƒ•ã‚¡ã‚¤ãƒ«å®‰å…¨ä¿å­˜"""
        try:
            with open(file_path, 'w', encoding='utf-8') as f:
                json.dump(data, f, indent=2, ensure_ascii=False)
            return True
        except Exception as e:
            print(f"âŒ JSONä¿å­˜ã‚¨ãƒ©ãƒ¼: {file_path} - {e}")
            return False
    
    def _extract_phase_number(self, phase):
        """Phaseç•ªå·æŠ½å‡º"""
        try:
            import re
            match = re.search(r'(\d+)', phase)
            return int(match.group(1)) if match else 1
        except:
            return 1
    
    def _estimate_completion(self, progress):
        """å®Œäº†æ™‚é–“æ¨å®š"""
        if progress >= 90:
            return "5_minutes"
        elif progress >= 70:
            return "15_minutes"
        elif progress >= 50:
            return "30_minutes"
        else:
            return "60_minutes"
    
    def _get_active_files(self):
        """ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§"""
        try:
            result = subprocess.run(['git', 'diff', '--name-only', 'HEAD'], 
                                  capture_output=True, text=True, cwd='.')
            files = result.stdout.strip().split('\n') if result.stdout.strip() else []
            return [f for f in files if f][:5]  # æœ€å¤§5ãƒ•ã‚¡ã‚¤ãƒ«
        except:
            return []
    
    def _format_constraints_enhanced(self, constraints_data):
        """åˆ¶ç´„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆå¼·åŒ–ç‰ˆï¼‰"""
        constraints = constraints_data.get('current_constraints', [])
        if not constraints:
            return "- ç¾åœ¨åˆ¶ç´„ãªã—"
        
        formatted = []
        for c in constraints[-3:]:  # æœ€æ–°3ä»¶
            priority = c.get('priority', 'medium')
            emoji = "ğŸš¨" if priority == "critical" else "âš ï¸" if priority == "high" else "ğŸ“"
            formatted.append(f"{emoji} **{c.get('constraint', 'Unknown')}**: {c.get('impact', 'No impact')}")
        
        return '\n'.join(formatted)
    
    def _format_constraints(self, constraints_data):
        """åˆ¶ç´„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆäº’æ›æ€§ç”¨ï¼‰"""
        return self._format_constraints_enhanced(constraints_data)
    
    def _format_next_commands(self, commands_data):
        """æ¬¡ã‚³ãƒãƒ³ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ"""
        immediate = commands_data.get('immediate_next', [])
        return '\n'.join(immediate[:3]) if immediate else "# æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã‚ã‚Šã¾ã›ã‚“"
    
    def _format_success_patterns(self, patterns_data):
        """æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ"""
        patterns = patterns_data.get('successful_patterns', [])
        if not patterns:
            return "- æ–°è¦å®Ÿè£…ï¼ˆæˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³è“„ç©ä¸­ï¼‰"
        
        latest = patterns[-1]
        return f"- **é©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³**: {latest.get('pattern', 'Unknown')}\n- **æˆåŠŸè¦å› **: {', '.join(latest.get('success_factors', []))}"


# ãƒ†ã‚¹ãƒˆç”¨é–¢æ•°
def test_continuation_manager_enhanced():
    """ç¶™ç¶šè¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ å¼·åŒ–ç‰ˆãƒ†ã‚¹ãƒˆ"""
    print("ğŸ§ª ç¶™ç¶šè¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ å¼·åŒ–ç‰ˆãƒ†ã‚¹ãƒˆé–‹å§‹")
    
    try:
        # ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
        cm = ProjectContinuationManager()
        print("âœ… ProjectContinuationManagerå¼·åŒ–ç‰ˆåˆæœŸåŒ–å®Œäº†")
        
        # Gitè©³ç´°è¨˜éŒ²ãƒ†ã‚¹ãƒˆ
        git_detail = cm.record_git_changes_detail()
        print(f"âœ… Gitè©³ç´°è¨˜éŒ²ãƒ†ã‚¹ãƒˆ: {git_detail.get('files_changed', 0)}ä»¶å¤‰æ›´ ({git_detail.get('change_scale', 'unknown')})")
        if git_detail.get('major_changes'):
            print(f"   ä¸»è¦å¤‰æ›´: {git_detail['major_changes'][:3]}")
        
        # è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        projects = ProjectContinuationManager.list_projects()
        print(f"âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§: {[p['name'] for p in projects]}")
        
        # ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¿å­˜ãƒ†ã‚¹ãƒˆ
        cm.save_work_snapshot(
            phase="kioku_system_enhancement",
            step="git_detail_and_multiproject",
            progress=95,
            description="Gitè©³ç´°è¨˜éŒ²+è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå¯¾å¿œå®Ÿè£…å®Œäº†",
            next_action="æœ€çµ‚ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ"
        )
        
        # 15ç§’ç¶™æ‰¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆãƒ†ã‚¹ãƒˆ
        handover = cm.generate_15sec_handover()
        print("âœ… 15ç§’ç¶™æ‰¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆå®Œäº†ï¼ˆå¼·åŒ–ç‰ˆï¼‰")
        
        # ç¾åœ¨çŠ¶æ³ç¢ºèª
        status = cm.get_current_status()
        print(f"ğŸ“Š ç¾åœ¨çŠ¶æ³: {status['project']} - {status['phase']} - {status['step']} ({status['progress']}%)")
        
        print("ğŸ‰ ç¶™ç¶šè¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ å¼·åŒ–ç‰ˆãƒ†ã‚¹ãƒˆå®Œäº†ï¼")
        return True
        
    except Exception as e:
        print(f"âŒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: {e}")
        return False


if __name__ == "__main__":
    test_continuation_manager_enhanced()
