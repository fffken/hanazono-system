#!/bin/bash
# è‡ªå‹•ç”Ÿæˆ: æ¤œå‡º:è‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ 
# ç”Ÿæˆæ™‚åˆ»: Mon  2 Jun 15:08:35 JST 2025

log() {
    echo "[2025-06-02 15:08:35] scripts/generated/auto_æ¤œå‡º:_system.sh" | tee -a "logs/auto_æ¤œå‡º:_20250602.log"
}

# æ¤œå‡º:è‡ªå‹•å‡¦ç†
auto_handle_æ¤œå‡º:() {
    log "ğŸ”§ æ¤œå‡º:è‡ªå‹•å‡¦ç†é–‹å§‹"
    
    # ãƒ‘ã‚¿ãƒ¼ãƒ³å›ºæœ‰ã®å‡¦ç†ã‚’ã“ã“ã«è¿½åŠ 
    # ç¾åœ¨ã¯åŸºæœ¬çš„ãªã‚·ã‚¹ãƒ†ãƒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
    
    # ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ãƒã‚§ãƒƒã‚¯
    if [ $(df / | tail -1 | awk '{print $5}' | sed 's/%//') -gt 80 ]; then
        log "âš ï¸ ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡è­¦å‘Š"
        # è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        find /tmp -type f -mtime +7 -delete 2>/dev/null || true
    fi
    
    # ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒã‚§ãƒƒã‚¯
    if [ $(free | grep Mem | awk '{print ($3/$2) * 100.0}' | cut -d. -f1) -gt 80 ]; then
        log "âš ï¸ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡è­¦å‘Š"
        # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
        sync && echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true
    fi
    
    log "âœ… æ¤œå‡º:è‡ªå‹•å‡¦ç†å®Œäº†"
}

# ãƒ¡ã‚¤ãƒ³å‡¦ç†
auto_handle_æ¤œå‡º:
