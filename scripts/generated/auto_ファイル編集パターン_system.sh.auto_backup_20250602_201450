#!/bin/bash
# УЄфтІЋућЪТѕљ: сЃЋсѓАсѓцсЃФуиежЏєсЃЉсѓ┐сЃ╝сЃ│УЄфтІЋтїќсѓисѓ╣сЃєсЃа
# ућЪТѕљТЎѓтѕ╗: Mon  2 Jun 15:08:35 JST 2025

log() {
    echo "[2025-06-02 15:08:35] scripts/generated/auto_сЃЋсѓАсѓцсЃФуиежЏєсЃЉсѓ┐сЃ╝сЃ│_system.sh" | tee -a "logs/auto_сЃЋсѓАсѓцсЃФуиежЏєсЃЉсѓ┐сЃ╝сЃ│_20250602.log"
}

# сЃЋсѓАсѓцсЃФуиежЏєсЃЉсѓ┐сЃ╝сЃ│УЄфтІЋтЄдуљє
auto_handle_сЃЋсѓАсѓцсЃФуиежЏєсЃЉсѓ┐сЃ╝сЃ│() {
    log "­ЪћД сЃЋсѓАсѓцсЃФуиежЏєсЃЉсѓ┐сЃ╝сЃ│УЄфтІЋтЄдуљєжќІтДІ"
    
    # сЃЉсѓ┐сЃ╝сЃ│тЏ║ТюЅсЂ«тЄдуљєсѓњсЂЊсЂЊсЂФУ┐йтіа
    # уЈЙтюесЂ»тЪ║ТюгуџёсЂфсѓисѓ╣сЃєсЃасЃўсЃФсѓ╣сЃЂсѓДсЃЃсѓ»
    
    # сЃЄсѓБсѓ╣сѓ»т«╣жЄЈсЃЂсѓДсЃЃсѓ»
    if [ $(df / | tail -1 | awk '{print $5}' | sed 's/%//') -gt 80 ]; then
        log "Рџа№ИЈ сЃЄсѓБсѓ╣сѓ»т«╣жЄЈУГдтЉі"
        # УЄфтІЋсѓ»сЃфсЃ╝сЃ│сѓбсЃЃсЃЌ
        find /tmp -type f -mtime +7 -delete 2>/dev/null || true
    fi
    
    # сЃАсЃбсЃфСй┐ућежЄЈсЃЂсѓДсЃЃсѓ»
    if [ $(free | grep Mem | awk '{print ($3/$2) * 100.0}' | cut -d. -f1) -gt 80 ]; then
        log "Рџа№ИЈ сЃАсЃбсЃфСй┐ућежЄЈУГдтЉі"
        # сѓГсЃБсЃЃсѓисЃЦсѓ»сЃфсѓб
        sync && echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || true
    fi
    
    log "РюЁ сЃЋсѓАсѓцсЃФуиежЏєсЃЉсѓ┐сЃ╝сЃ│УЄфтІЋтЄдуљєт«їС║є"
}

# сЃАсѓцсЃ│тЄдуљє
auto_handle_сЃЋсѓАсѓцсЃФуиежЏєсЃЉсѓ┐сЃ╝сЃ│
