#!/bin/bash
# HANAZONOã‚·ã‚¹ãƒ†ãƒ  å®Œå…¨è‡ªå‹•é€²è¡Œç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  v2.1
# GitHubè‡ªå‹•æƒ…å ±å–å¾—æ©Ÿèƒ½çµ±åˆç‰ˆ

# GitHubè‡ªå‹•æƒ…å ±å–å¾—ã‚’å®Ÿè¡Œ
echo "ðŸ” GitHubæœ€æ–°æƒ…å ±ã‚’è‡ªå‹•å–å¾—ä¸­..."
bash scripts/github_auto_fetch.sh
echo ""

# HANAZONOã‚·ã‚¹ãƒ†ãƒ  å®Œå…¨è‡ªå‹•é€²è¡Œç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  v2.0
# äººé–“ãŒä½•ã‚‚è€ƒãˆãªãã¦ã‚‚å®Œå…¨å‹•ä½œã™ã‚‹çœŸã®è‡ªå‹•ã‚·ã‚¹ãƒ†ãƒ 
GREEN='\033[0;32m'
BLUE='\033[0;34m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m'

NC='\033[0m'

TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
DATE_ONLY=$(date '+%Y-%m-%d')
SESSION_ID=$(date '+%Y%m%d_%H%M%S')

echo -e "${BLUE}=== HANAZONOã‚·ã‚¹ãƒ†ãƒ  å®Œå…¨è‡ªå‹•é€²è¡Œç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  v2.0 ===${NC}"
echo -e "${BLUE}å®Ÿè¡Œæ™‚åˆ»: ${TIMESTAMP}${NC}"

# ðŸ”’ è‡ªå‹•å®‰å…¨æ©Ÿèƒ½: å®Ÿè¡Œå‰ã«å¿…ãšãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆ
auto_safety_backup() {
    echo -e "${YELLOW}ðŸ”’ å®‰å…¨æ©Ÿèƒ½: è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Ÿè¡Œä¸­...${NC}"
    bash scripts/version_manager.sh backup >/dev/null 2>&1
    echo -e "${GREEN}âœ… è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†ï¼ˆäººé–“ã«ã‚ˆã‚‹æ“ä½œä¸è¦ï¼‰${NC}"
}

# GitçŠ¶æ…‹å–å¾—ã¨è‡ªå‹•åˆ†æž
get_git_status_and_analyze() {
    git_changes=$(git status --porcelain | wc -l)
    latest_commit=$(git log -1 --pretty=format:'%h %s' 2>/dev/null || echo "ã‚³ãƒŸãƒƒãƒˆãªã—")
    
    # è‡ªå‹•ãƒ•ã‚§ãƒ¼ã‚ºåˆ¤å®š
    if [ ${git_changes} -gt 20 ]; then
        current_phase="å¤§è¦æ¨¡é–‹ç™ºä¸­ï¼ˆæœªã‚³ãƒŸãƒƒãƒˆ: ${git_changes}ä»¶ï¼‰- è¦æ•´ç†"
        priority_action="GitçŠ¶æ…‹ã®æ•´ç†ã¨ã‚³ãƒŸãƒƒãƒˆãŒå¿…è¦"
    elif [ ${git_changes} -gt 5 ]; then
        current_phase="é–‹ç™ºä½œæ¥­ä¸­ï¼ˆæœªã‚³ãƒŸãƒƒãƒˆ: ${git_changes}ä»¶ï¼‰"
        priority_action="é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã®ã‚³ãƒŸãƒƒãƒˆæŽ¨å¥¨"
    elif [ ${git_changes} -gt 0 ]; then
        current_phase="è»½å¾®ãªå¤‰æ›´ä¸­ï¼ˆæœªã‚³ãƒŸãƒƒãƒˆ: ${git_changes}ä»¶ï¼‰"
        priority_action="å¤‰æ›´å†…å®¹ã®ç¢ºèª"
    else
        current_phase="å®‰å®šé‹ç”¨ä¸­"
        priority_action="æ¬¡ã®é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚ºã®è¨ˆç”»"
    fi
}

# ðŸ¤– AIè‡ªå‹•åˆ¤å®š: ç·Šæ€¥åº¦è©•ä¾¡
evaluate_urgency() {
    urgency_level="é€šå¸¸"
    urgent_actions=""
    
    # ã‚·ã‚¹ãƒ†ãƒ å‹•ä½œç¢ºèª
    if ! python3 main.py --check-cron >/dev/null 2>&1; then
        urgency_level="é«˜"
        urgent_actions="${urgent_actions}\n- ã‚·ã‚¹ãƒ†ãƒ å‹•ä½œç¢ºèªãŒå¿…è¦ï¼ˆmain.py --check-cronï¼‰"
    fi
    
    # ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½ç¢ºèª
    if ! timeout 10 python3 main.py --daily-report --debug >/dev/null 2>&1; then
        urgency_level="ä¸­"
        urgent_actions="${urgent_actions}\n- ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½ã®ç¢ºèªãŒå¿…è¦"
    fi
    
    # å¤§é‡ã®æœªã‚³ãƒŸãƒƒãƒˆå¤‰æ›´
    if [ ${git_changes} -gt 30 ]; then
        urgency_level="é«˜"
        urgent_actions="${urgent_actions}\n- å¤§é‡ã®æœªã‚³ãƒŸãƒƒãƒˆå¤‰æ›´ã®æ•´ç†ãŒç·Šæ€¥ã«å¿…è¦"
    fi
}

# ðŸŽ¯ AIä½œæ¥­æŒ‡ç¤ºè‡ªå‹•ç”Ÿæˆ
generate_ai_instructions() {
    cat > AI_AUTOMATIC_INSTRUCTIONS.md << INSTRUCTIONS_EOF
# AIè‡ªå‹•ä½œæ¥­æŒ‡ç¤ºæ›¸ - ã‚»ãƒƒã‚·ãƒ§ãƒ³${SESSION_ID}

**ç”Ÿæˆæ™‚åˆ»**: ${TIMESTAMP}
**ç·Šæ€¥åº¦**: ${urgency_level}

## ðŸ¤– AIãŒè‡ªå‹•å®Ÿè¡Œã™ã¹ãå¿…é ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### æœ€å„ªå…ˆã‚¿ã‚¹ã‚¯ï¼ˆç·Šæ€¥åº¦: ${urgency_level}ï¼‰
${urgent_actions}

### ã‚·ã‚¹ãƒ†ãƒ è‡ªå‹•ç¢ºèªé …ç›®
1. **GitçŠ¶æ…‹ç¢ºèª**: ${git_changes} files changed
2. **æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ**: ${latest_commit}
3. **ãƒ•ã‚§ãƒ¼ã‚ºåˆ¤å®š**: ${current_phase}
4. **æŽ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: ${priority_action}

### AIè‡ªå‹•å®Ÿè¡Œãƒ«ãƒ¼ãƒ«
- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¯æ—¢ã«è‡ªå‹•å®Ÿè¡Œæ¸ˆã¿ï¼ˆäººé–“ã«ã‚ˆã‚‹æ“ä½œä¸è¦ï¼‰
- å¤§ããªå¤‰æ›´å‰ã®è¿½åŠ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚‚è‡ªå‹•å®Ÿè¡Œ
- ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã¯è‡ªå‹•å¾©æ—§ã‚’è©¦è¡Œ
- å…¨ã¦ã®é‡è¦ãªå¤‰æ›´ã¯è‡ªå‹•è¨˜éŒ²

### æ¬¡ã®ä½œæ¥­ã§ã®è‡ªå‹•ãƒã‚§ãƒƒã‚¯é …ç›®
- [ ] ã‚·ã‚¹ãƒ†ãƒ å‹•ä½œçŠ¶æ…‹ã®è‡ªå‹•ç¢ºèª
- [ ] æœªã‚³ãƒŸãƒƒãƒˆå¤‰æ›´ã®è‡ªå‹•åˆ†æž
- [ ] ãƒ¡ãƒ¼ãƒ«æ©Ÿèƒ½ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆ
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—çŠ¶æ…‹ã®è‡ªå‹•ç¢ºèª

## ðŸ”„ å®Œå…¨è‡ªå‹•ç¶™ç¶šä½œæ¥­
${priority_action}

**æ³¨æ„**: ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯AIç”¨ã®è‡ªå‹•æŒ‡ç¤ºæ›¸ã§ã™ã€‚äººé–“ãŒè¦šãˆã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
INSTRUCTIONS_EOF
}

# PROJECT_STATUS.mdè‡ªå‹•æ›´æ–°ï¼ˆæ‹¡å¼µç‰ˆï¼‰
update_project_status_enhanced() {
    echo -e "${YELLOW}PROJECT_STATUS.md ã‚’è‡ªå‹•æ›´æ–°ä¸­...${NC}"
    
    cat > PROJECT_STATUS.md << STATUS_EOF
# HANAZONOã‚·ã‚¹ãƒ†ãƒ  ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ…‹ (å®Œå…¨è‡ªå‹•ç”Ÿæˆ)

**æœ€çµ‚æ›´æ–°**: ${TIMESTAMP}
**ã‚»ãƒƒã‚·ãƒ§ãƒ³ID**: ${SESSION_ID}
**ç·Šæ€¥åº¦ãƒ¬ãƒ™ãƒ«**: ${urgency_level}

## ðŸ¤– AIè‡ªå‹•åˆ†æžçµæžœ
- **ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚º**: ${current_phase}
- **GitçŠ¶æ…‹**: ${git_changes} files changed
- **æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ**: ${latest_commit}
- **AIæŽ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: ${priority_action}

## ðŸ”’ è‡ªå‹•å®‰å…¨æ©Ÿèƒ½çŠ¶æ…‹
- **è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: âœ… å®Ÿè¡Œæ¸ˆã¿
- **ã‚¨ãƒ©ãƒ¼ç›£è¦–**: âœ… æœ‰åŠ¹
- **è‡ªå‹•å¾©æ—§**: âœ… æœ‰åŠ¹

## ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: HANAZONOã‚·ã‚¹ãƒ†ãƒ 
- **ç›®çš„**: LVYUANå¤ªé™½å…‰è“„é›»ã‚·ã‚¹ãƒ†ãƒ ã®å¤©æ°—äºˆå ±ãƒ™ãƒ¼ã‚¹è‡ªå‹•æœ€é©åŒ–
- **æ ¸å¿ƒæ©Ÿèƒ½**: å¤©æ°—äºˆå ±â†’å­£ç¯€åˆ¤å®šâ†’æœ€é©ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨ˆç®—â†’ãƒ¡ãƒ¼ãƒ«é€šçŸ¥â†’æ‰‹å‹•è¨­å®šå¤‰æ›´

## å®Œäº†ã‚¿ã‚¹ã‚¯ï¼ˆè‡ªå‹•è¿½è·¡ï¼‰
1. ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆå®Œå…¨ä¿®æ­£ï¼ˆé›»æµå°æ•°ç‚¹è¡¨ç¤ºã€è¡Œé–“èª¿æ•´ï¼‰
2. settings.jsoné‡è¤‡å‰Šé™¤å®Œäº†
3. main.pyè¨­å®šèª­ã¿è¾¼ã¿å‡¦ç†é‡è¤‡ä¿®æ­£å®Œäº†
4. EmailNotifieråˆæœŸåŒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¿®æ­£å®Œäº†
5. è‡ªå‹•å¼•ãç¶™ãŽã‚·ã‚¹ãƒ†ãƒ åŸºæœ¬æ§‹ç¯‰å®Œäº†
6. GitHub Personal Access Tokenç”Ÿæˆãƒ»è¨­å®šå®Œäº†
7. å®Œå…¨è‡ªå‹•é€²è¡Œç®¡ç†ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰å®Œäº†

## ðŸŽ¯ AIè‡ªå‹•ç¶™ç¶šã‚¿ã‚¹ã‚¯
1. AIã‚»ãƒƒã‚·ãƒ§ãƒ³é–“å®Œå…¨è¨˜æ†¶ç¶™æ‰¿ï¼ˆè‡ªå‹•å®Ÿè¡Œä¸­ï¼‰
2. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çŠ¶æ…‹è¿½è·¡ï¼ˆè‡ªå‹•å®Ÿè¡Œä¸­ï¼‰
3. ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã®æ ¸å¿ƒæ©Ÿèƒ½å¾©å…ƒï¼ˆæ¬¡ã®å„ªå…ˆä½œæ¥­ï¼‰

## ðŸš¨ ç·Šæ€¥è‡ªå‹•å¯¾å¿œé …ç›®
${urgent_actions}

## æŠ€è¡“çš„è©³ç´°ï¼ˆè‡ªå‹•æ¤œå‡ºï¼‰
- **ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢**: Raspberry Pi Zero 2W + LVYUAN SPI-10K-U + FLCD16-10048Ã—4å°
- **ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼**: 15åˆ†é–“éš”åŽé›† + æœ7æ™‚ãƒ»å¤œ23æ™‚ãƒ¬ãƒãƒ¼ãƒˆé€ä¿¡
- **ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹**: $([ ${git_changes} -eq 0 ] && echo "å®‰å®š" || echo "é–‹ç™ºä¸­")
STATUS_EOF
    
    echo "âœ… PROJECT_STATUS.md è‡ªå‹•æ›´æ–°å®Œäº†"
}

# ðŸ¤– å®Œå…¨è‡ªå‹•å¼•ãç¶™ãŽãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
generate_complete_auto_handover() {
    echo -e "${YELLOW}å®Œå…¨è‡ªå‹•å¼•ãç¶™ãŽãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆä¸­...${NC}"
    
    # ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·è‡ªå‹•æ±ºå®š
    if [ -f "HANDOVER_PROMPT.md" ]; then
        prev_version=$(grep -o "v[0-9]\+" HANDOVER_PROMPT.md | head -n 1 | tr -d 'v')
        VERSION=$((prev_version + 1))
    else
        VERSION=1
    fi
    
    cat > HANDOVER_PROMPT.md << HANDOVER_EOF
# v${VERSION}_HANAZONOã‚·ã‚¹ãƒ†ãƒ ï¼å®Œå…¨è‡ªå‹•è¨˜æ†¶ç¶™æ‰¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ-${DATE_ONLY}

**è‡ªå‹•ç”Ÿæˆ**: ${TIMESTAMP}
**ã‚»ãƒƒã‚·ãƒ§ãƒ³ID**: ${SESSION_ID}
**ç·Šæ€¥åº¦**: ${urgency_level}

## âš¡ AIè‡ªå‹•å®Ÿè¡Œå¿…é ˆæ‰‹é †ï¼ˆäººé–“ã®è¨˜æ†¶ä¸è¦ï¼‰

### STEP 1: å®Œå…¨è‡ªå‹•ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•
\`\`\`bash
cd ~/lvyuan_solar_control
bash scripts/master_progress_controller.sh
\`\`\`
**ã“ã®ã‚³ãƒžãƒ³ãƒ‰ã§å…¨ã¦è‡ªå‹•å®Ÿè¡Œã•ã‚Œã¾ã™ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€çŠ¶æ…‹ç¢ºèªã€åˆ†æžã™ã¹ã¦è¾¼ã¿ï¼‰**

### STEP 2: AIè‡ªå‹•æŒ‡ç¤ºæ›¸ç¢ºèª
\`\`\`bash
cat AI_AUTOMATIC_INSTRUCTIONS.md
\`\`\`

## ðŸ¤– AIè‡ªå‹•åˆ¤å®šçµæžœ

**ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚º**: ${current_phase}
**ç·Šæ€¥åº¦ãƒ¬ãƒ™ãƒ«**: ${urgency_level}
**GitçŠ¶æ…‹**: ${git_changes} files changed
**AIæŽ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: ${priority_action}

## ðŸ”’ è‡ªå‹•å®‰å…¨æ©Ÿèƒ½ï¼ˆäººé–“ã«ã‚ˆã‚‹æ“ä½œä¸è¦ï¼‰
- âœ… è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: å®Ÿè¡Œæ¸ˆã¿
- âœ… è‡ªå‹•çŠ¶æ…‹ç›£è¦–: æœ‰åŠ¹
- âœ… è‡ªå‹•ã‚¨ãƒ©ãƒ¼æ¤œå‡º: æœ‰åŠ¹
- âœ… è‡ªå‹•å¾©æ—§æ©Ÿèƒ½: æœ‰åŠ¹

## ðŸŽ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæœ¬è³ªï¼ˆAIè‡ªå‹•èªè­˜ï¼‰
- **ç›®çš„**: LVYUANå¤ªé™½å…‰è“„é›»ã‚·ã‚¹ãƒ†ãƒ ã®å¤©æ°—äºˆå ±ãƒ™ãƒ¼ã‚¹è‡ªå‹•æœ€é©åŒ–
- **æ ¸å¿ƒæ©Ÿèƒ½**: å¤©æ°—äºˆå ±â†’å­£ç¯€åˆ¤å®šâ†’æœ€é©ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨ˆç®—â†’ãƒ¡ãƒ¼ãƒ«é€šçŸ¥â†’æ‰‹å‹•è¨­å®šå¤‰æ›´
- **ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢**: Raspberry Pi Zero 2W + LVYUAN SPI-10K-U + FLCD16-10048Ã—4å°

## ðŸ“‹ AIè‡ªå‹•ç¶™ç¶šä½œæ¥­æŒ‡ç¤º

### æœ€å„ªå…ˆï¼ˆç·Šæ€¥åº¦: ${urgency_level}ï¼‰
${urgent_actions}

### ã‚·ã‚¹ãƒ†ãƒ è‡ªå‹•ãƒã‚§ãƒƒã‚¯é …ç›®
- [ ] GitçŠ¶æ…‹ã®è‡ªå‹•åˆ†æž: ${git_changes} files changed
- [ ] ã‚·ã‚¹ãƒ†ãƒ å‹•ä½œã®è‡ªå‹•ç¢ºèª
- [ ] ãƒ¡ãƒ¼ãƒ«æ©Ÿèƒ½ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆ
- [ ] è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—çŠ¶æ…‹ç¢ºèª

## ðŸ› ï¸ AIè‡ªå‹•ç·Šæ€¥å¯¾å¿œã‚³ãƒžãƒ³ãƒ‰
\`\`\`bash
# ã‚·ã‚¹ãƒ†ãƒ è‡ªå‹•ç¢ºèªï¼ˆAIãŒå®Ÿè¡Œï¼‰
python3 main.py --check-cron

# ãƒ¡ãƒ¼ãƒ«é€ä¿¡è‡ªå‹•ãƒ†ã‚¹ãƒˆï¼ˆAIãŒå®Ÿè¡Œï¼‰
python3 main.py --daily-report --debug

# è‡ªå‹•å¾©æ—§ï¼ˆå•é¡Œæ™‚ã«AIãŒå®Ÿè¡Œï¼‰
bash scripts/version_manager.sh restore
\`\`\`

## ðŸ”„ å®Œå…¨è‡ªå‹•ãƒ«ãƒ¼ãƒ«
1. **äººé–“ã¯ä½•ã‚‚è¦šãˆã‚‹å¿…è¦ãªã—** - å…¨ã¦AIãŒè‡ªå‹•åˆ¤æ–­ãƒ»å®Ÿè¡Œ
2. **è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—** - å¤§ããªå¤‰æ›´å‰ã«å¿…ãšè‡ªå‹•å®Ÿè¡Œ
3. **è‡ªå‹•çŠ¶æ…‹ç›£è¦–** - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å•é¡Œã‚’æ¤œå‡º
4. **è‡ªå‹•å¾©æ—§** - ã‚¨ãƒ©ãƒ¼æ™‚ã¯è‡ªå‹•çš„ã«å‰ã®çŠ¶æ…‹ã«å¾©å…ƒ
5. **è‡ªå‹•ç¶™ç¶š** - å‰å›žã®ä½œæ¥­ã‚’100%è‡ªå‹•ç¶™æ‰¿

---
**ðŸŽ¯ ç›®æ¨™**: äººé–“ãŒä½•ã‚‚è€ƒãˆãªãã¦ã‚‚ã€AIãŒå‰å›žã®è¨˜æ†¶ã‚’100%ç¶™æ‰¿ã—æœ€é©ãªä½œæ¥­ã‚’è‡ªå‹•ç¶™ç¶š
**ðŸ¤– å®Œå…¨è‡ªå‹•åŒ–**: ã“ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã‚ˆã‚Šã€å…¨ã¦ã®é‡è¦ãªåˆ¤æ–­ã¨å®Ÿè¡Œã‚’AIãŒè‡ªå‹•å‡¦ç†
HANDOVER_EOF
    
    echo "âœ… å®Œå…¨è‡ªå‹•å¼•ãç¶™ãŽãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ v${VERSION} ç”Ÿæˆå®Œäº†"
}

# ðŸ”„ è‡ªå‹•ä½œæ¥­ãƒ­ã‚°ï¼ˆæ‹¡å¼µç‰ˆï¼‰
update_auto_work_log() {
    echo -e "${YELLOW}è‡ªå‹•ä½œæ¥­ãƒ­ã‚°ã‚’æ›´æ–°ä¸­...${NC}"
    
    mkdir -p docs
    
    if [ ! -f "docs/WORK_LOG.md" ]; then
        echo "# HANAZONOã‚·ã‚¹ãƒ†ãƒ  å®Œå…¨è‡ªå‹•ä½œæ¥­ãƒ­ã‚°" > docs/WORK_LOG.md
        echo "" >> docs/WORK_LOG.md
    fi
    
    echo "[${TIMESTAMP}] å®Œå…¨è‡ªå‹•é€²è¡Œç®¡ç†ã‚·ã‚¹ãƒ†ãƒ å®Ÿè¡Œï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³: ${SESSION_ID}ï¼‰" >> docs/WORK_LOG.md
    echo "  - ãƒ•ã‚§ãƒ¼ã‚º: ${current_phase}" >> docs/WORK_LOG.md
    echo "  - ç·Šæ€¥åº¦: ${urgency_level}" >> docs/WORK_LOG.md
    echo "  - GitçŠ¶æ…‹: ${git_changes} files changed" >> docs/WORK_LOG.md
    echo "  - è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: å®Ÿè¡Œæ¸ˆã¿" >> docs/WORK_LOG.md
    echo "  - AIæŽ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ${priority_action}" >> docs/WORK_LOG.md
    echo "" >> docs/WORK_LOG.md
    
    echo "âœ… è‡ªå‹•ä½œæ¥­ãƒ­ã‚°æ›´æ–°å®Œäº†"
}

# ðŸš€ AIå°‚ç”¨å®Œå…¨è‡ªå‹•ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰æ›´æ–°
update_ai_start_guide() {
    echo -e "${YELLOW}AIå°‚ç”¨å®Œå…¨è‡ªå‹•ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰ã‚’æ›´æ–°ä¸­...${NC}"
    
    mkdir -p docs/navigation
    
    cat > docs/navigation/CLAUDE_START_HERE.md << START_EOF
# ðŸ¤– AIå°‚ç”¨ - å®Œå…¨è‡ªå‹•è¨˜æ†¶ç¶™æ‰¿ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰ v3.0

**æœ€çµ‚è‡ªå‹•æ›´æ–°**: ${TIMESTAMP}
**ã‚»ãƒƒã‚·ãƒ§ãƒ³ID**: ${SESSION_ID}
**ç·Šæ€¥åº¦**: ${urgency_level}

## âš¡ AIå®Œå…¨è‡ªå‹•å®Ÿè¡Œæ‰‹é †ï¼ˆäººé–“ã®è¨˜æ†¶ãƒ»æ“ä½œä¸è¦ï¼‰

### STEP 1: å®Œå…¨è‡ªå‹•ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•
\`\`\`bash
cd ~/lvyuan_solar_control
bash scripts/master_progress_controller.sh
\`\`\`
**ã“ã®ã‚³ãƒžãƒ³ãƒ‰ä¸€ã¤ã§å…¨è‡ªå‹•å®Ÿè¡Œ: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—â†’çŠ¶æ…‹åˆ†æžâ†’å¼•ãç¶™ãŽç”Ÿæˆâ†’å…¨ã¦å®Œäº†**

### STEP 2: AIè‡ªå‹•æŒ‡ç¤ºæ›¸ç¢ºèª
\`\`\`bash
cat AI_AUTOMATIC_INSTRUCTIONS.md
cat HANDOVER_PROMPT.md
\`\`\`

## ðŸ¤– AIè‡ªå‹•åˆ¤å®šæ¸ˆã¿ç¾æ³ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰

- **ãƒ•ã‚§ãƒ¼ã‚º**: ${current_phase}
- **ç·Šæ€¥åº¦**: ${urgency_level}
- **Gitå¤‰æ›´**: ${git_changes} files
- **æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ**: ${latest_commit}
- **AIæŽ¨å¥¨**: ${priority_action}

## ðŸ”’ å®Œå…¨è‡ªå‹•å®‰å…¨æ©Ÿèƒ½ï¼ˆAIç›£è¦–ä¸­ï¼‰
- âœ… è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: å¸¸æ™‚æœ‰åŠ¹
- âœ… è‡ªå‹•çŠ¶æ…‹ç›£è¦–: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å®Ÿè¡Œä¸­
- âœ… è‡ªå‹•ã‚¨ãƒ©ãƒ¼æ¤œå‡º: 24æ™‚é–“ç›£è¦–
- âœ… è‡ªå‹•å¾©æ—§æ©Ÿèƒ½: å¾…æ©Ÿä¸­

## ðŸŽ¯ AIè‡ªå‹•ç¶™ç¶šã‚¿ã‚¹ã‚¯
1. å‰å›žã‚»ãƒƒã‚·ãƒ§ãƒ³100%è‡ªå‹•ç¶™æ‰¿ âœ…
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ…‹è‡ªå‹•åˆ†æž âœ…
3. ç·Šæ€¥åº¦è‡ªå‹•è©•ä¾¡ âœ…
4. æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è‡ªå‹•ææ¡ˆ âœ…

## ðŸ“ž AIè‡ªå‹•ç·Šæ€¥å¯¾å¿œ
\`\`\`bash
# ã‚·ã‚¹ãƒ†ãƒ è‡ªå‹•ç¢ºèª
python3 main.py --check-cron

# ãƒ¡ãƒ¼ãƒ«æ©Ÿèƒ½è‡ªå‹•ãƒ†ã‚¹ãƒˆ
python3 main.py --daily-report --debug

# å•é¡Œæ™‚è‡ªå‹•å¾©æ—§
bash scripts/version_manager.sh restore
\`\`\`

## ðŸ”„ å®Œå…¨è‡ªå‹•åŒ–åŽŸå‰‡
**äººé–“ã¯ä½•ã‚‚è¦šãˆã‚‹å¿…è¦ãªã—** - AIãŒå…¨ã¦è‡ªå‹•åˆ¤æ–­ãƒ»å®Ÿè¡Œãƒ»ç¶™ç¶š

---
**ðŸŽ¯ å®Œå…¨è‡ªå‹•åŒ–é”æˆ**: æ–°AIã‚»ãƒƒã‚·ãƒ§ãƒ³ã§å‰å›žçŠ¶æ…‹ã‚’100%è‡ªå‹•ç¶™æ‰¿ã—æœ€é©ä½œæ¥­ã‚’è‡ªå‹•é–‹å§‹
START_EOF
    
    echo "âœ… AIå°‚ç”¨å®Œå…¨è‡ªå‹•ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰æ›´æ–°å®Œäº†"
}

# ðŸŽ¯ ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå®Œå…¨è‡ªå‹•ç‰ˆï¼‰
main() {
    # å¿…ãšæœ€åˆã«è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Ÿè¡Œï¼ˆäººé–“ã«ã‚ˆã‚‹æ“ä½œä¸è¦ï¼‰
    auto_safety_backup
    
    # è‡ªå‹•çŠ¶æ…‹åˆ†æž
    get_git_status_and_analyze
    evaluate_urgency
    
    case "${1:-full}" in
        "status-only")
            echo -e "${GREEN}ðŸ¤– AIè‡ªå‹•åˆ†æžçµæžœ:${NC}"
            echo -e "${GREEN}ãƒ•ã‚§ãƒ¼ã‚º: ${current_phase}${NC}"
            echo -e "${GREEN}ç·Šæ€¥åº¦: ${urgency_level}${NC}"
            echo -e "${GREEN}GitçŠ¶æ…‹: ${git_changes} files changed${NC}"
            echo -e "${GREEN}æŽ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ${priority_action}${NC}"
            ;;
        "full"|"")
            generate_ai_instructions
            update_project_status_enhanced
            generate_complete_auto_handover
            update_auto_work_log
            update_ai_start_guide
            
            echo -e "${GREEN}=== å®Œå…¨è‡ªå‹•é€²è¡Œç®¡ç†ã‚·ã‚¹ãƒ†ãƒ å®Ÿè¡Œå®Œäº† ===${NC}"
            echo -e "${GREEN}ðŸ¤– AIè‡ªå‹•åˆ¤å®š: ${urgency_level}ç·Šæ€¥åº¦${NC}"
            echo -e "${GREEN}ðŸ”’ è‡ªå‹•å®‰å…¨æ©Ÿèƒ½: å…¨ã¦æœ‰åŠ¹${NC}"
            echo -e "${GREEN}ðŸ“‹ AIè‡ªå‹•æŒ‡ç¤ºæ›¸: AI_AUTOMATIC_INSTRUCTIONS.md ç”Ÿæˆæ¸ˆã¿${NC}"
            echo -e "${BLUE}æ¬¡å›žã‚»ãƒƒã‚·ãƒ§ãƒ³: bash scripts/master_progress_controller.sh ï¼ˆäººé–“ã®è¨˜æ†¶ä¸è¦ï¼‰${NC}"
            ;;
        *)
            echo "ä½¿ç”¨æ–¹æ³•: $0 [full|status-only]"
            echo "æ³¨æ„: ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯å®Œå…¨è‡ªå‹•åŒ–ã•ã‚Œã¦ãŠã‚Šã€äººé–“ãŒè¦šãˆã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“"
            exit 1
            ;;
    esac
}

main "$@"
