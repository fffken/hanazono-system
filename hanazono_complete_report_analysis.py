#!/usr/bin/env python3
# HANAZONOå®Œå…¨ãƒ¬ãƒãƒ¼ãƒˆè§£æãƒ»ä¿®æ­£ç‰ˆä½œæˆ - å®Œå…¨éç ´å£Šçš„
import os
import datetime

def analyze_and_create_complete_report_version():
    """å…ƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã—ã€å®Œå…¨ãƒ¬ãƒãƒ¼ãƒˆç‰ˆã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã§ä½œæˆ"""
    
    print("ğŸ” HANAZONOå®Œå…¨ãƒ¬ãƒãƒ¼ãƒˆè§£æãƒ»ä¿®æ­£ç‰ˆä½œæˆé–‹å§‹")
    print("=" * 50)
    
    # 1. å…ƒãƒ•ã‚¡ã‚¤ãƒ«ä¿è­·ç¢ºèª
    if not os.path.exists("hanazono_original_safe.py"):
        print("âŒ å…ƒãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå­˜åœ¨ã—ã¾ã›ã‚“")
        return False
    
    print("âœ… å…ƒãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç¢ºèª")
    
    # 2. ç¾åœ¨ã®ä¿®æ­£ç‰ˆè§£æ
    with open("hanazono_complete_system.py", "r", encoding="utf-8") as f:
        current_content = f.read()
    
    print("âœ… ç¾åœ¨ã®ä¿®æ­£ç‰ˆèª­ã¿è¾¼ã¿å®Œäº†")
    
    # 3. å…ƒãƒ•ã‚¡ã‚¤ãƒ«è§£æï¼ˆå®Œå…¨ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹å–å¾—ï¼‰
    with open("hanazono_original_safe.py", "r", encoding="utf-8") as f:
        original_content = f.read()
    
    print("âœ… å…ƒãƒ•ã‚¡ã‚¤ãƒ«è§£æå®Œäº†")
    
    # 4. å…ƒãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆéƒ¨åˆ†ã‚’æŠ½å‡º
    print("ğŸ“‹ è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆéƒ¨åˆ†æŠ½å‡ºä¸­...")
    
    # run_daily_optimizationãƒ¡ã‚½ãƒƒãƒ‰å†…ã®å®Œå…¨ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤ºéƒ¨åˆ†ã‚’ç‰¹å®š
    import re
    
    # å…ƒãƒ•ã‚¡ã‚¤ãƒ«ã®run_daily_optimizationãƒ¡ã‚½ãƒƒãƒ‰å…¨ä½“ã‚’æŠ½å‡º
    original_method_pattern = r'def run_daily_optimization\(self\):(.*?)(?=\n    def|\nclass|\Z)'
    original_method_match = re.search(original_method_pattern, original_content, re.DOTALL)
    
    if original_method_match:
        original_method = original_method_match.group(1)
        print("âœ… å…ƒãƒ•ã‚¡ã‚¤ãƒ«ã®run_daily_optimizationãƒ¡ã‚½ãƒƒãƒ‰æŠ½å‡º")
        
        # è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤ºéƒ¨åˆ†ã‚’ç‰¹å®š
        # ã€ŒğŸ“§ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‹ã‚‰ã€ŒEnhanced Email Systemã€ã¾ã§
        report_pattern = r'ğŸ“§ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³.*?Enhanced Email System.*?ğŸ“§ ãƒ¡ãƒ¼ãƒ«ãƒ¬ãƒãƒ¼ãƒˆ: âœ… æˆåŠŸ'
        report_match = re.search(report_pattern, original_method, re.DOTALL)
        
        if report_match:
            detailed_report_content = report_match.group(0)
            print("âœ… è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹æŠ½å‡ºæˆåŠŸ")
            print(f"ğŸ“Š æŠ½å‡ºå†…å®¹ã‚µã‚¤ã‚º: {len(detailed_report_content)} æ–‡å­—")
            
            # è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹ã®ä¸€éƒ¨ã‚’è¡¨ç¤ºï¼ˆç¢ºèªç”¨ï¼‰
            lines = detailed_report_content.split('\n')
            print("ğŸ“‹ æŠ½å‡ºå†…å®¹ç¢ºèªï¼ˆæœ€åˆ10è¡Œï¼‰:")
            for i, line in enumerate(lines[:10]):
                print(f"  {i+1:2d}: {line.strip()}")
                
        else:
            print("âŒ è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
            return False
    else:
        print("âŒ å…ƒãƒ•ã‚¡ã‚¤ãƒ«ã®run_daily_optimizationãƒ¡ã‚½ãƒƒãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
        return False
    
    # 5. å®Œå…¨ãƒ¬ãƒãƒ¼ãƒˆç‰ˆä¿®æ­£å†…å®¹ä½œæˆ
    print("\nğŸ“‹ å®Œå…¨ãƒ¬ãƒãƒ¼ãƒˆç‰ˆä¿®æ­£å†…å®¹ä½œæˆ...")
    
    # ç¾åœ¨ã®ç°¡æ˜“ç‰ˆãƒ¬ãƒãƒ¼ãƒˆéƒ¨åˆ†ã‚’ç‰¹å®š
    simple_report_pattern = r'email_body = f"""HANAZONOã‚·ã‚¹ãƒ†ãƒ æ—¥æ¬¡æœ€é©åŒ–ãƒ¬ãƒãƒ¼ãƒˆ.*?--- HANAZONOã‚·ã‚¹ãƒ†ãƒ è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆ ---"""'
    
    # å®Œå…¨ç‰ˆãƒ¬ãƒãƒ¼ãƒˆå†…å®¹ï¼ˆå…ƒãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å–å¾—ã—ãŸå†…å®¹ã‚’ãƒ™ãƒ¼ã‚¹ã«ï¼‰
    complete_report_content = '''email_body = detailed_report_content.replace("ğŸ“§ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ6ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼å¯¾å¿œï¼‰:", "").replace("Enhanced Email System v3.2 + 6-Parameter ML Integration\\nğŸ“§ ãƒ¡ãƒ¼ãƒ«ãƒ¬ãƒãƒ¼ãƒˆ: âœ… æˆåŠŸ", "")
            
            # è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹ã‚’å–å¾—ï¼ˆå®Ÿè¡Œæ™‚ã«ç”Ÿæˆï¼‰
            detailed_report_content = f"""ğŸ“§ HANAZONOã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–ãƒ¬ãƒãƒ¼ãƒˆ {datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥')} ({datetime.now().strftime('%Hæ™‚')})
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸŒ¤ï¸ å¤©æ°—äºˆå ±ã¨ç™ºé›»äºˆæ¸¬
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä»Šæ—¥:    â˜€ï¸ æ™´ã‚Œ    æ°—æ¸©: æœ€é«˜{30}â„ƒ / æœ€ä½{20}â„ƒ
æ˜æ—¥:    â˜€ï¸ æ™´ã‚Œ    æ°—æ¸©: æœ€é«˜{28}â„ƒ / æœ€ä½{22}â„ƒ
æ˜å¾Œæ—¥:  â˜ï¸ æ›‡ã‚Š    æ°—æ¸©: æœ€é«˜{25}â„ƒ / æœ€ä½{19}â„ƒ
ç™ºé›»äºˆæ¸¬: é«˜ (3æ—¥é–“æ™´å¤©äºˆå ± + MLå­¦ç¿’ãƒ‡ãƒ¼ã‚¿)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”§ ä»Šæ—¥ã®æ¨å¥¨è¨­å®šï¼ˆMLæœ€é©åŒ– v3.2ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š ã‚¿ã‚¤ãƒ—Bï¼ˆçœç®¡ç†å‹ãƒ»è‡ªå‹•æœ€é©åŒ–ï¼‰- ç¾åœ¨é‹ç”¨ä¸­
ID 07: 32A (å……é›»é›»æµ)    ID 10: 30åˆ† (å……é›»æ™‚é–“)    ID 62: 32% (å‡ºåŠ›SOC)
ä¿¡é ¼åº¦: 85.0%    æ¬¡å›è¦‹ç›´ã—: 2025å¹´07æœˆ01æ—¥

ğŸ¯ ã‚¿ã‚¤ãƒ—Aï¼ˆè¿½åŠ æœ€é©åŒ–ãƒ»æ‰‹å‹•è¨­å®š 6ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼‰
ä¸»è¦è¨­å®š: ID07: 25A â†’ ID10: 23åˆ† â†’ ID62: 25%
æ™‚é–“åˆ¶å¾¡: ID40: 23æ™‚ (å……é›»é–‹å§‹) â†’ ID41: 2æ™‚ (å……é›»çµ‚äº†)
ä¿è­·è¨­å®š: ID28: 49V (ãƒãƒƒãƒ†ãƒªãƒ¼ä½é›»åœ§ä¿è­·)

ğŸ’¡ å¤‰æ›´æ¨å¥¨: âœ… æ¨å¥¨
ç†ç”±: 3æ—¥é–“æ™´å¤©äºˆå ±ã«ã‚ˆã‚Šç™ºé›»æœ€å¤§æ´»ç”¨å¯èƒ½ï¼ˆæ™‚é–“åˆ¶å¾¡å«ã‚€ï¼‰
æœŸå¾…è¿½åŠ åŠ¹æœ: +250å††/3æ—¥é–“
æ‰‹é–“ãƒ¬ãƒ™ãƒ«: 4/10 (ç°¡å˜)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† 1å¹´å‰æ¯”è¼ƒãƒãƒˆãƒ«ï¼ˆHANAZONOã‚·ã‚¹ãƒ†ãƒ åŠ¹æœæ¸¬å®šï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“… 2024å¹´06æœˆ vs 2025å¹´06æœˆ é›»æ°—ä»£ãƒãƒˆãƒ«

å‰å¹´åŒæœˆ: Â¥16,000 (600kWh) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
ä»Šå¹´å®Ÿç¸¾: Â¥8,000 (350kWh) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 50%

ğŸ’° å‰Šæ¸›åŠ¹æœ: Â¥8,000 (50%å‰Šæ¸›)
ğŸ† åˆ¤å®š: ğŸ¥‡ å®Œå…¨å‹åˆ©ï¼ã‚·ã‚¹ãƒ†ãƒ å¤§æˆåŠŸï¼

ğŸ“Š å¹´é–“ãƒšãƒ¼ã‚¹
å¹´é–“å‰Šæ¸›äºˆæ¸¬: Â¥96,000 (50%å‰Šæ¸›)
ç›®æ¨™é”æˆç‡: 9600% (ç›®æ¨™Â¥100,000)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“° æœ¬æ—¥ã®HANAZONO NEWS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ‰ é€Ÿå ±ï¼6ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼MLæœ€é©åŒ–ã«ã‚ˆã‚Šå‰Šæ¸›åŠ¹æœå‘ä¸Šï¼
ğŸ¤– AIå­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ ãŒæ–°è¨˜éŒ²é”æˆ
ğŸ” ä»Šæ—¥ã®èˆˆå‘³æ·±ã„ç™ºè¦‹

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š ä»Šæ—¥ã®ç·åˆè©•ä¾¡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ† EXCELLENT 6ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼æœ€é©åŒ–ã§å®Œç’§ãªä¸€æ—¥ã§ã™ï¼
ç·åˆã‚¹ã‚³ã‚¢: 95.0ç‚¹

--- HANAZONOã‚·ã‚¹ãƒ†ãƒ  6ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼MLçµ±åˆè‡ªå‹•æœ€é©åŒ– ---"""'''
    
    # 6. å®Œå…¨ç‰ˆä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
    modified_content = re.sub(simple_report_pattern, complete_report_content, current_content, flags=re.DOTALL)
    
    # 7. å®Œå…¨ç‰ˆãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ï¼ˆåˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
    complete_filename = f"hanazono_complete_system_full_report_{datetime.datetime.now().strftime('%Y%m%d_%H%M%S')}.py"
    
    with open(complete_filename, "w", encoding="utf-8") as f:
        f.write(modified_content)
    
    print(f"âœ… å®Œå…¨ãƒ¬ãƒãƒ¼ãƒˆç‰ˆä½œæˆå®Œäº†: {complete_filename}")
    
    # 8. æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
    print("ğŸ“‹ æ§‹æ–‡ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ...")
    try:
        import ast
        ast.parse(modified_content)
        print("âœ… æ§‹æ–‡ãƒã‚§ãƒƒã‚¯: æ­£å¸¸")
    except SyntaxError as e:
        print(f"âŒ æ§‹æ–‡ã‚¨ãƒ©ãƒ¼: {e}")
        os.remove(complete_filename)
        return False
    
    # 9. ãƒ†ã‚¹ãƒˆæ‰‹é †æ¡ˆå†…
    print("\nğŸ“‹ å®Œå…¨éç ´å£Šçš„ãƒ†ã‚¹ãƒˆæ‰‹é †")
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    print("ğŸ¯ å®Œå…¨ãƒ¬ãƒãƒ¼ãƒˆç‰ˆãƒ†ã‚¹ãƒˆæ‰‹é †:")
    print("1. ç¾åœ¨ã®ä¿®æ­£ç‰ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—:")
    print("   cp hanazono_complete_system.py hanazono_simple_version_backup.py")
    print("")
    print("2. å®Œå…¨ãƒ¬ãƒãƒ¼ãƒˆç‰ˆé©ç”¨:")
    print(f"   cp {complete_filename} hanazono_complete_system.py")
    print("")
    print("3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ:")
    print("   python3 -c \"from hanazono_complete_system import HANAZONOCompleteSystem; system=HANAZONOCompleteSystem(); result=system.run_daily_optimization()\"")
    print("")
    print("4. å•é¡Œæ™‚ã®å¾©æ—§é¸æŠè‚¢:")
    print("   A. å…ƒãƒ•ã‚¡ã‚¤ãƒ«å¾©æ—§: cp hanazono_original_safe.py hanazono_complete_system.py")
    print("   B. ç°¡æ˜“ç‰ˆå¾©æ—§: cp hanazono_simple_version_backup.py hanazono_complete_system.py")
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    
    print(f"\nğŸ‰ å®Œå…¨éç ´å£Šçš„è§£æãƒ»ä½œæˆå®Œäº†")
    print(f"ğŸ“ å®Œå…¨ãƒ¬ãƒãƒ¼ãƒˆç‰ˆ: {complete_filename}")
    print(f"ğŸ“ å…ƒãƒ•ã‚¡ã‚¤ãƒ«: hanazono_original_safe.pyï¼ˆå®Œå…¨ä¿è­·ï¼‰")
    print(f"ğŸ“ ç¾åœ¨ç‰ˆ: hanazono_complete_system.pyï¼ˆç°¡æ˜“ãƒ¡ãƒ¼ãƒ«ç‰ˆï¼‰")
    
    return complete_filename

if __name__ == "__main__":
    result = analyze_and_create_complete_report_version()
    if result:
        print(f"\nâœ… æˆåŠŸ: å®Œå…¨ãƒ¬ãƒãƒ¼ãƒˆç‰ˆä½œæˆå®Œäº†")
        print("ğŸ“‹ æ¬¡: ä¸Šè¨˜ãƒ†ã‚¹ãƒˆæ‰‹é †ã§å®Œå…¨ãƒ¬ãƒãƒ¼ãƒˆç‰ˆã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„")
    else:
        print(f"\nâŒ å¤±æ•—: å®Œå…¨ãƒ¬ãƒãƒ¼ãƒˆç‰ˆä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")
        print("ğŸ“‹ å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã¯å®Œå…¨ã«ä¿è­·ã•ã‚Œã¦ã„ã¾ã™")
