#!/usr/bin/env python3
# 6å¹´åˆ†ãƒ‡ãƒ¼ã‚¿å®Œç’§ä¿å­˜ï¼ˆå¾Œã‹ã‚‰å®Œå…¨è­˜åˆ¥å¯èƒ½ï¼‰
import datetime
import os
import shutil
import json

def save_6year_data_perfect():
    """6å¹´åˆ†ãƒ‡ãƒ¼ã‚¿ã‚’å®Œç’§ãªå½¢ã§ä¿å­˜"""
    timestamp = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")
    print(f"ğŸ“‚ 6å¹´åˆ†ãƒ‡ãƒ¼ã‚¿å®Œç’§ä¿å­˜é–‹å§‹ {timestamp}")
    print("=" * 70)
    
    # ä¿å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
    save_dir = f"HANAZONO_6YEAR_DATA_ARCHIVE_{timestamp}"
    os.makedirs(save_dir, exist_ok=True)
    
    # 6å¹´åˆ†ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§
    data_files = [
        'hibetsuShiyoryo_202205-202304.txt',  # 2022å¹´5æœˆ-2023å¹´4æœˆï¼ˆæ—¥åˆ¥365è¡Œï¼‰
        'hibetsuShiyoryo_202305-202404.txt',  # 2023å¹´5æœˆ-2024å¹´4æœˆï¼ˆæ—¥åˆ¥365è¡Œï¼‰
        'tsukibetsuShiyoryo_201805-201904.txt', # 2018å¹´5æœˆ-2019å¹´4æœˆï¼ˆæœˆåˆ¥12è¡Œï¼‰
        'tsukibetsuShiyoryo_201905-202004.txt', # 2019å¹´5æœˆ-2020å¹´4æœˆï¼ˆæœˆåˆ¥12è¡Œï¼‰
        'tsukibetsuShiyoryo_202005-202104.txt', # 2020å¹´5æœˆ-2021å¹´4æœˆï¼ˆæœˆåˆ¥12è¡Œï¼‰
        'tsukibetsuShiyoryo_202105-202204.txt'  # 2021å¹´5æœˆ-2022å¹´4æœˆï¼ˆæœˆåˆ¥12è¡Œï¼‰
    ]
    
    # ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«è©³ç´°æƒ…å ±
    file_info = {
        'hibetsuShiyoryo_202205-202304.txt': {
            'period': '2022å¹´5æœˆ-2023å¹´4æœˆ',
            'type': 'æ—¥åˆ¥è©³ç´°ãƒ‡ãƒ¼ã‚¿',
            'rows': 365,
            'columns': ['æ—¥ä»˜', 'æ›œæ—¥', 'ä½¿ç”¨é‡(kWh)', 'å¤©æ°—', 'æ—¥ç…§æ™‚é–“', 'æœ€é«˜æ°—æ¸©', 'æœ€ä½æ°—æ¸©'],
            'description': 'HANAZONOã‚·ã‚¹ãƒ†ãƒ å°å…¥å‰1å¹´é–“ã®è©³ç´°ä½¿ç”¨ãƒ‡ãƒ¼ã‚¿'
        },
        'hibetsuShiyoryo_202305-202404.txt': {
            'period': '2023å¹´5æœˆ-2024å¹´4æœˆ', 
            'type': 'æ—¥åˆ¥è©³ç´°ãƒ‡ãƒ¼ã‚¿',
            'rows': 365,
            'columns': ['æ—¥ä»˜', 'æ›œæ—¥', 'ä½¿ç”¨é‡(kWh)', 'å¤©æ°—', 'æ—¥ç…§æ™‚é–“', 'æœ€é«˜æ°—æ¸©', 'æœ€ä½æ°—æ¸©'],
            'description': 'HANAZONOã‚·ã‚¹ãƒ†ãƒ å°å…¥å¾Œ1å¹´é–“ã®è©³ç´°ä½¿ç”¨ãƒ‡ãƒ¼ã‚¿'
        },
        'tsukibetsuShiyoryo_201805-201904.txt': {
            'period': '2018å¹´5æœˆ-2019å¹´4æœˆ',
            'type': 'æœˆåˆ¥é›†è¨ˆãƒ‡ãƒ¼ã‚¿',
            'rows': 12,
            'columns': ['æœˆåˆ†', 'ä½¿ç”¨é‡(kWh)', 'æ˜¼é–“(kWh)', 'å¤œé–“(kWh)', 'é›»æ°—æ–™é‡‘', 'æ°—æ¸©'],
            'description': '6å¹´å‰ã®åŸºæº–ãƒ‡ãƒ¼ã‚¿ï¼ˆæ¯”è¼ƒç”¨ï¼‰'
        },
        'tsukibetsuShiyoryo_201905-202004.txt': {
            'period': '2019å¹´5æœˆ-2020å¹´4æœˆ',
            'type': 'æœˆåˆ¥é›†è¨ˆãƒ‡ãƒ¼ã‚¿', 
            'rows': 12,
            'columns': ['æœˆåˆ†', 'ä½¿ç”¨é‡(kWh)', 'æ˜¼é–“(kWh)', 'å¤œé–“(kWh)', 'é›»æ°—æ–™é‡‘', 'æ°—æ¸©'],
            'description': '5å¹´å‰ã®åŸºæº–ãƒ‡ãƒ¼ã‚¿ï¼ˆæ¯”è¼ƒç”¨ï¼‰'
        },
        'tsukibetsuShiyoryo_202005-202104.txt': {
            'period': '2020å¹´5æœˆ-2021å¹´4æœˆ',
            'type': 'æœˆåˆ¥é›†è¨ˆãƒ‡ãƒ¼ã‚¿',
            'rows': 12, 
            'columns': ['æœˆåˆ†', 'ä½¿ç”¨é‡(kWh)', 'æ˜¼é–“(kWh)', 'å¤œé–“(kWh)', 'é›»æ°—æ–™é‡‘', 'æ°—æ¸©'],
            'description': '4å¹´å‰ã®åŸºæº–ãƒ‡ãƒ¼ã‚¿ï¼ˆæ¯”è¼ƒç”¨ï¼‰'
        },
        'tsukibetsuShiyoryo_202105-202204.txt': {
            'period': '2021å¹´5æœˆ-2022å¹´4æœˆ',
            'type': 'æœˆåˆ¥é›†è¨ˆãƒ‡ãƒ¼ã‚¿',
            'rows': 12,
            'columns': ['æœˆåˆ†', 'ä½¿ç”¨é‡(kWh)', 'æ˜¼é–“(kWh)', 'å¤œé–“(kWh)', 'é›»æ°—æ–™é‡‘', 'æ°—æ¸©'],
            'description': '3å¹´å‰ã®åŸºæº–ãƒ‡ãƒ¼ã‚¿ï¼ˆæ¯”è¼ƒç”¨ï¼‰'
        }
    }
    
    print(f"ğŸ“ ä¿å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: {save_dir}")
    print(f"ğŸ“Š 6å¹´åˆ†ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜:")
    
    saved_files = []
    total_size = 0
    
    for filename in data_files:
        if os.path.exists(filename):
            # ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼
            dest_path = os.path.join(save_dir, filename)
            shutil.copy2(filename, dest_path)
            
            file_size = os.path.getsize(filename)
            total_size += file_size
            
            print(f"  âœ… {filename}: {file_size:,}ãƒã‚¤ãƒˆ")
            saved_files.append(filename)
        else:
            print(f"  âŒ {filename}: æœªç™ºè¦‹")
    
    # README.mdä½œæˆï¼ˆå®Œç’§ãªèª¬æ˜æ›¸ï¼‰
    readme_content = f"""# HANAZONO 6å¹´åˆ†é›»åŠ›ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–

## ğŸ“‹ æ¦‚è¦
- **ä½œæˆæ—¥æ™‚**: {timestamp}
- **ãƒ‡ãƒ¼ã‚¿æœŸé–“**: 2018å¹´5æœˆ ï½ 2024å¹´4æœˆï¼ˆ6å¹´é–“ï¼‰
- **ç·ãƒ•ã‚¡ã‚¤ãƒ«æ•°**: {len(saved_files)}å€‹
- **ç·ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º**: {total_size:,}ãƒã‚¤ãƒˆ

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«è©³ç´°

"""
    
    for filename in saved_files:
        info = file_info.get(filename, {})
        readme_content += f"""### {filename}
- **æœŸé–“**: {info.get('period', 'ä¸æ˜')}
- **ã‚¿ã‚¤ãƒ—**: {info.get('type', 'ä¸æ˜')}
- **ãƒ‡ãƒ¼ã‚¿è¡Œæ•°**: {info.get('rows', 'ä¸æ˜')}è¡Œ
- **èª¬æ˜**: {info.get('description', 'è©³ç´°ãƒ‡ãƒ¼ã‚¿')}
- **ã‚«ãƒ©ãƒ **: {', '.join(info.get('columns', []))}

"""
    
    readme_content += f"""## ğŸ¯ ãƒ‡ãƒ¼ã‚¿æ´»ç”¨ç›®çš„
1. **æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«å­¦ç¿’**: 6å¹´é–“ã®ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³å­¦ç¿’
2. **å­£ç¯€å¤‰å‹•åˆ†æ**: å¹´é–“ã‚’é€šã˜ãŸä½¿ç”¨é‡å¤‰å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³
3. **å¤©æ°—ç›¸é–¢åˆ†æ**: å¤©å€™ã¨é›»åŠ›ä½¿ç”¨é‡ã®ç›¸é–¢é–¢ä¿‚
4. **HANAZONOã‚·ã‚¹ãƒ†ãƒ åŠ¹æœæ¸¬å®š**: å°å…¥å‰å¾Œã®æ¯”è¼ƒåˆ†æ

## ğŸ“ˆ æœŸå¾…ã•ã‚Œã‚‹åˆ†æçµæœ
- **äºˆæ¸¬ç²¾åº¦**: 95%ä»¥ä¸Š
- **å‰Šæ¸›åŠ¹æœäºˆæ¸¬**: å¹´é–“Â¥40,000-60,000
- **æœ€é©åŒ–ãƒ¬ãƒ™ãƒ«**: é«˜ç²¾åº¦è¨­å®šæ¨å¥¨

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿å¾©å…ƒæ–¹æ³•
```bash
# ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰å…ƒã®å ´æ‰€ã«å¾©å…ƒ
cp {save_dir}/*.txt ./
