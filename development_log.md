
---

## 2025-06-08: 根本原因の特定と最終的な教訓

### 経緯
度重なる`ModuleNotFoundError`に悩まされ、仮想環境の再構築や`git reset`を繰り返すも、問題は解決しなかった。一時はOSまたはSDカードの物理的な破損という、AIによる早計な結論に至りかけた。

### 最終的な診断
ユーザーの的確な指摘により、「バックグラウンドプロセスの干渉」という最後の可能性を検証する実験を実施。

1.  `pkill`コマンドで全ての関連バックグラウンドプロセス（ゴースト・プロセス）を強制終了させる。
2.  完全に沈黙した環境下で、`venv`の再構築と`pip install`を実行。
3.  `ls -l`コマンドで物理的なファイルの存在を確認したところ、**初めてライブラリが正常にディスク上に作成されていることが判明した。**

### 結論
**根本原因は、OSや`pip`の破損ではなく、常駐していたバックグラウンドプロセスが、`pip`のファイル書き込み処理をリアルタイムで妨害していたことであった。**

### 教訓
* **いかなる時も、事実確認を怠ってはならない。** 観測された全ての事実を説明できる仮説が立つまで、安易な結論（特にハードウェア故障など、修復が困難なもの）に飛びついてはならない。
* **「動いているように見える」システムでも、不可視のプロセスが予期せぬ破壊活動を行っている可能性がある。** パッケージインストールのような基本的な操作が不可解な失敗を繰り返す場合、常駐プロセスの干渉を第一に疑うべきである。
* **短気や感情は、正確な判断を曇らせる最大の敵である。**

---

---

### 【標準作業手順書】一時診断スクリプトを活用した、安全なデバッグ・修正プロトコル

#### 1. 基本理念：使い捨てのメスによる、クリーンな外科手術
このプロジェクトは、多数の自動化スクリプトが稼働しており、予期せぬ相互作用（副作用）を起こしやすい「汚染されやすい環境」である。この環境下で、既存のファイルを直接編集するのは危険である。そこで、特定の目的（診断、修正、検証）のためだけに、独立した、使い捨てのPythonスクリプトを作成し、目的達成後に即座に破棄する「一時診断スクリプト」という手法を採用する。

#### 2. 実行プロトコル（5ステップ）
1.  **目的の定義と、スクリプトの作成:** `nano [一時スクリプト名].py`
2.  **診断・修正コードの記述:** 目的達成のための最小限のコードを記述する。
3.  **スクリプトの実行:** `python3 [一時スクリプト名].py` で実行し、結果を観測する。
4.  **結果の分析と判断:** 実行結果という「事実」に基づき、次のアクションを判断する。
5.  **スクリプトの破棄:** `rm [一時スクリプト名].py` で、作業完了後に必ず削除する。

#### 3. 実践例（今回の治療における成功例）
* **`unified_scanner.py`:** 複数の主要コンポーネントの健全性を、横断的に確認した。
* **`final_test_capsule.py`:** 環境汚染の仮説を証明するため、外部依存から切り離された「無菌室」でコアロジックを検証した。
* **`diagnose_advanced_email.py`:** 本番に近い形でテストし、モジュール間の連携エラーを発見した。

#### 4. この手法の利点
* **非破壊性:** 既存のソースコードを直接書き換えないため安全。
* **隔離性:** 問題の切り分けが容易になる。
* **明確性:** スクリプトの意図が明確になる。
* **再現性:** 同じスクリプトで同じ診断を再現できる。
* **クリーン:** プロジェクト内にゴミを残さない。

---
