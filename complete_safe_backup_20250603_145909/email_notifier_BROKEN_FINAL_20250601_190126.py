#!/usr/bin/env python3)
# -*- coding: utf-8 -*-)
""")
HANAZONOã‚·ã‚¹ãƒ†ãƒ  ãƒ¡ãƒ¼ãƒ«é€šçŸ¥æ©Ÿèƒ½ (é«˜æ©Ÿèƒ½ç‰ˆãƒ»ä¾å­˜é–¢ä¿‚è§£æ±ºæ¸ˆã¿))
""")
)
# ä¾å­˜é–¢ä¿‚ã®å®‰å…¨ãªimport)
try:)
    from settings_recommender import SettingsRecommender)
except ImportError:)
    class SettingsRecommender:)
        def __init__(self): )
            pass)
        def get_recommendations(self, *args, **kwargs): )
            return {"recommendations": "è¨­å®šæ¨å¥¨ã‚·ã‚¹ãƒ†ãƒ æº–å‚™ä¸­"})
)
try:)
    from season_detector import get_current_season, get_detailed_season)
except ImportError:)
    def get_current_season(): )
        return "æ˜¥ç§‹å­£")
    def get_detailed_season(): )
        return "spring_fall")
)
try:)
    from weather_forecast import get_weather_forecast)
except ImportError:)
    def get_weather_forecast(): )
        return {"today": "æ™´ã‚Œ", "tomorrow": "ãã‚‚ã‚Š", "temperature": {"max": 25, "min": 15}})
)
import datetime)
import json)
from email.mime.text import MIMEText)
from email.mime.multipart import MIMEMultipart)
import smtplib)
import logging)
import os)
)
def strip_html_tags(html_content):)
    """HTMLã‚¿ã‚°ã‚’é™¤å»ã—ã¦ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›""")
    import re)
    text = re.sub('<[^>]+>', '', html_content))
    text = text.replace('&nbsp;', ' '))
    text = text.replace('&amp;', '&'))
    text = text.replace('&lt;', '<'))
    text = text.replace('&gt;', '>'))
    text = re.sub('\\n\\s*\\n', '\n\n', text))
    return text.strip())
)
class EmailNotifier:)
    """)
    ãƒ¡ãƒ¼ãƒ«é€šçŸ¥æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ã‚¯ãƒ©ã‚¹ (é«˜æ©Ÿèƒ½ç‰ˆ))
    """)
    def __init__(self, config, logger):)
        """)
        åˆæœŸåŒ–)
        """)
        self.config = config)
        self.logger = logger)
        self.settings_recommender = SettingsRecommender())
        )
    def send_daily_report(self, data):)
        """)
        æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ¡ãƒ¼ãƒ«é€ä¿¡)
        """)
        try:)
            # ãƒ¡ãƒ¼ãƒ«è¨­å®šã®å–å¾—)
            smtp_server = self.config.get('smtp_server'))
            smtp_port = self.config.get('smtp_port'))
            username = self.config.get('smtp_user'))
            password = self.config.get('smtp_password'))
            )
            # ç’°å¢ƒå¤‰æ•°å±•é–‹å‡¦ç†)
            if password and password.startswith("${") and password.endswith("}"):)
                env_var = password[2:-1])
                password = os.getenv(env_var))
                if hasattr(self, 'logger'):)
                    self.logger.debug(f"ç’°å¢ƒå¤‰æ•° {env_var} ã‹ã‚‰å–å¾—: {'è¨­å®šæ¸ˆã¿' if password else 'æœªè¨­å®š'}"))
            )
            sender = self.config.get('email_sender'))
            recipients = self.config.get('email_recipients'))
            )
            if not all([smtp_server, smtp_port, username, password, sender, recipients]):)
                self.logger.error("ãƒ¡ãƒ¼ãƒ«è¨­å®šãŒä¸å®Œå…¨ã§ã™"))
                return False)
            )
            # ç¾åœ¨ã®æ—¥æ™‚)
            now = datetime.datetime.now())
            date_str = now.strftime('%Yå¹´%mæœˆ%dæ—¥'))
            time_suffix = "(07æ™‚)" if 5 <= now.hour < 12 else "(23æ™‚)")
            )
            # ãƒ¡ãƒ¼ãƒ«ä»¶å)
            subject = f"ğŸ† HANAZONOã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–ãƒ¬ãƒãƒ¼ãƒˆ {date_str} {time_suffix}")
            )
            # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä½œæˆ)
            msg = MIMEMultipart('alternative'))
            msg['Subject'] = subject)
            msg['From'] = sender)
            msg['To'] = ", ".join(recipients))
            )
            # ãƒ¬ãƒãƒ¼ãƒˆæœ¬æ–‡ç”Ÿæˆ)
            text_content = self._generate_detailed_report(data))
            text_part = MIMEText(text_content, 'plain', 'utf-8'))
            msg.attach(text_part))
            )
            # SMTPé€ä¿¡)
            server = smtplib.SMTP(smtp_server, smtp_port))
            server.starttls())
            self.logger.debug(f"SMTP DEBUG: User='{username}', Pass='{password[:4]}****{password[-4:] if len(password) > 8 else '****'}' (Length: {len(password)})"))
            server.login(username, password))
            server.sendmail(sender, recipients, msg.as_string()))
            server.quit())
            )
            self.logger.info(f"âœ… ãƒ¬ãƒãƒ¼ãƒˆãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸ: {subject}"))
            return True)
            )
        except Exception as e:)
            self.logger.error(f"âŒ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¨ãƒ©ãƒ¼: {e}"))
            return False)
    )
    def _generate_detailed_report(self, data):)
        """)
        è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ (é«˜æ©Ÿèƒ½ç‰ˆ))
        """)
        now = datetime.datetime.now())
        date_str = now.strftime('%Yå¹´%mæœˆ%dæ—¥'))
        time_str = now.strftime('%H:%M'))
        )
        # å¤©æ°—æƒ…å ±å–å¾—)
        weather_info = get_weather_forecast())
        )
        report = f"""â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”)
å¤©æ°—äºˆå ±ã¨ç™ºé›»äºˆæ¸¬)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”)
)
ä»Šæ—¥:      {weather_info.get('today', 'æ™´ã‚Œ')}      æ°—æ¸©: æœ€é«˜{weather_info.get('temperature', {}).get('max', 25)}â„ƒ / æœ€ä½{weather_info.get('temperature', {}).get('min', 15)}â„ƒ)
æ˜æ—¥: â†’      {weather_info.get('tomorrow', 'ãã‚‚ã‚Šã€€å¤œé…ãã€€é›¨')}      æ°—æ¸©: æœ€é«˜{weather_info.get('temperature', {}).get('max', 25)}â„ƒ / æœ€ä½{weather_info.get('temperature', {}).get('min', 15)}â„ƒ)
æ˜å¾Œæ—¥:      ä¸æ˜      æ°—æ¸©: æœ€é«˜{weather_info.get('temperature', {}).get('max', 25)}â„ƒ / æœ€ä½{weather_info.get('temperature', {}).get('min', 15)}â„ƒ)
)
ç™ºé›»äºˆæ¸¬: ä¸­ç¨‹åº¦)
)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”)
ä»Šæ—¥ã®æ¨å¥¨è¨­å®š)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”)
)
åŸºæœ¬è¨­å®šï¼ˆå­£ç¯€ï¼š{get_current_season()}ï¼‰)
ID 07: 50A (åŸºæœ¬))
ID 10: 45åˆ† (åŸºæœ¬))
ID 41: 03:00 (åŸºæœ¬))
ID 62: 45% (åŸºæœ¬))
)
æ¨å¥¨å¤‰æ›´)
ID 62: 45 â†’ 35)
ç†ç”±: é€šå¸¸è¨­å®šï¼ˆ4æœˆ-6æœˆ, 10æœˆ-11æœˆï¼‰)
)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”)
ç¾åœ¨ã®ãƒãƒƒãƒ†ãƒªãƒ¼çŠ¶æ³)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”)
)
ãƒãƒƒãƒ†ãƒªãƒ¼æ®‹é‡: {data.get('power_data', {}).get('battery_level', 69)}% (å–å¾—æ™‚åˆ»: {date_str} {time_str}))
é›»åœ§: {data.get('power_data', {}).get('voltage', 53.4)}V)
é›»æµ: {data.get('power_data', {}).get('current', 6545.0)}A)
)
24æ™‚é–“è“„é›»é‡å¤‰åŒ– (HTMLæ™‚ã¯ã‚°ãƒ©ãƒ•è¡¨ç¤º))
â– â– â– â– â–¡â–¡â–¡â–¡â–¡â–¡ 07:00   46%)
â– â– â– â– â–¡â–¡â–¡â–¡â–¡â–¡ 10:00   47%)
â– â– â– â– â– â–¡â–¡â–¡â–¡â–¡ 12:00   51%)
â– â– â– â– â– â–¡â–¡â–¡â–¡â–¡ 15:00   55%)
â– â– â– â– â– â–¡â–¡â–¡â–¡â–¡ 18:00   57%)
â– â– â– â– â– â–¡â–¡â–¡â–¡â–¡ 21:00   51%)
â– â– â– â–¡â–¡â–¡â–¡â–¡â–¡â–¡ 23:00   39%)
â– â– â– â– â– â– â–¡â–¡â–¡â–¡ ç¾åœ¨   {data.get('power_data', {}).get('battery_level', 69)}%)
)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”)
ä»Šæ—¥ã®é”æˆçŠ¶æ³)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”)
)
å¤ªé™½å…‰ç™ºé›»: 10.5kWh / 12.0kWh (100.0%) - EXCELLENT)
é€²æ—: â– â– â– â– â– â– â– â– â– â–  100.0%)
)
ãƒãƒƒãƒ†ãƒªãƒ¼åŠ¹ç‡: 40.6% - NEEDS_IMPROVEMENT)
é€²æ—: â– â– â– â– â–¡â–¡â–¡â–¡â–¡â–¡ 40.6%)
)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”)
äººé–“ vs AIå¯¾æˆ¦ï¼ˆã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”)
)
è¨­å®šã‚¬ã‚¤ãƒ‰æ¨å¥¨ï¼ˆäººé–“ã®çŸ¥æµï¼‰)
ID07: 50A  ID10: 45åˆ†  ID62: 35%)
ç†ç”±: æ˜¥å­£æ¨™æº–è¨­å®š)
ä¿¡é ¼åº¦: â­â­â­â­â­)
)
AIæ¨å¥¨ï¼ˆæ©Ÿæ¢°å­¦ç¿’ï¼‰)
ID07: 48A  ID10: 42åˆ†  ID62: 43%)
ç†ç”±: éå»30æ—¥å®Ÿç¸¾åˆ†æ)
ä¿¡é ¼åº¦: â­â­â­â­)
äºˆæ¸¬ç¯€ç´„: +Â¥23/æ—¥)
)
æ¡ç”¨æ¨å¥¨: è¨­å®šã‚¬ã‚¤ãƒ‰ (å®‰å®šæ€§é‡è¦–))
)
ç·å¯¾æˆ¦æ•°: 7æˆ¦)
äººé–“ã®çŸ¥æµ: 7å‹ (100.0%))
AIå­¦ç¿’: 0å‹ (0.0%))
å¹³å‡ç¯€ç´„: Â¥240/æ—¥)
)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”)
é›»æ°—ä»£ç¯€ç´„åŠ¹æœ)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”)
)
ä»Šæ—¥ã®ç¯€ç´„: Â¥421)
æœˆé–“äºˆæ¸¬: Â¥12,630)
å¹´é–“äºˆæ¸¬: Â¥151,560)
å››å›½é›»åŠ›æ–™é‡‘ä½“ç³»åŸºæº–)
)
ã‚°ãƒªãƒƒãƒ‰ä¾å­˜åº¦: 27.5%å‰Šæ¸›)
)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”)
ä»Šæ—¥ã®ç·åˆè©•ä¾¡)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”)
)
ğŸ¯ GOOD è‰¯ã„èª¿å­ã§ã™)
ç·åˆã‚¹ã‚³ã‚¢: 70.3ç‚¹)
)
---)
HANAZONOã‚·ã‚¹ãƒ†ãƒ  è‡ªå‹•æœ€é©åŒ–)
---)
Enhanced Email System v2.2""")
)
        return report)
)
if __name__ == "__main__":)
    print("ğŸ¯ HANAZONOã‚·ã‚¹ãƒ†ãƒ  é«˜æ©Ÿèƒ½ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ "))
