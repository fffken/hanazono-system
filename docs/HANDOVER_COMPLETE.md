# v3_HANAZONOシステム自動最適化プロジェクト／引き継ぎプロンプト-2025-05-03

## プロジェクト概要
HANAZONOシステム自動最適化プロジェクトは、Raspberry Pi Zero 2 Wを使用してLVYUANソーラー蓄電システム（SPI-10K-Uインバーター、FLCD16-10048バッテリー4台構成）の監視・分析・最適化を行うシステムです。天気予報データと連携し、最適な充電・放電パラメーターを推奨することで、効率的な電力運用を実現します。

## 現在の状況
1. プロジェクト管理体制の改善のために、ドキュメント構造を整備しました（docs/以下）
2. 重大な問題として、メール通知機能が簡略化され、本来の機能（天気予報連携、推奨設定表示など）が失われていることが判明
3. メール送信問題（前日データ不足時のフォールバック処理）の修正に取り組み中
## これまでの成果
1. プロジェクト管理のためのドキュメント構造を整備:
   - docs/CRITICAL_NOTES.md: 重要事項の記録
   - docs/PROJECT_MASTER.md: プロジェクトマスタードキュメント
   - docs/guidelines/: 開発ワークフロー、コーディング規約、バージョン管理ルール
   - docs/references/: リファレンス資料（インバーターレジスタ、パラメーター設定）
   - docs/versions/: バージョン履歴管理

2. プロジェクトの根幹情報の集約:
   - 「統合ロードマップ+」の内容をPROJECT_MASTER.mdに統合
   - 「補足資料パック」の内容の構造をIMPLEMENTATION_DETAILSに反映
   - 重要な設定値（季節ごとの推奨パラメーター）を保存

## 次のステップ
1. **メール通知機能の復元** [最優先]
   - email_notifier.pyのsend_daily_report関数を元の機能を復元するよう修正
   - 天気予報データ取得機能の確認または再実装
   - 季節判定ロジックの確認または再実装
   - 推奨パラメータ計算の確認または再実装
   - テスト送信による動作確認
## 注意点と制約
1. **プロジェクトの核心機能を見失わないこと**:
   - 天気予報に基づく最適パラメータ推奨が本プロジェクトの核心
   - メール通知はその情報を届ける重要な手段
   - 簡略化や「省略」の際は必ず代替案と復元手段を明記

2. **インバーターの制約**:
   - インバーターには書き込み保護があり、読み取りのみ可能
   - 設定変更は手動で行う必要がある

3. **リソース制約**:
   - Raspberry Pi Zero 2 Wはリソースが限られているため効率的なコード実装が必要

## 対話進行方法
- 企画・検討段階では、アイデアと構造の議論に集中
- 「これで進めてください」などの明示的な承認があるまで最終成果物は生成しない
- 実装段階に入る前に「では実際の作業に入りますか？」などで確認を取る
- 段階的に進め、各ステップで確認・調整を行う
## 容量監視と自動引き継ぎプロンプト
1. **容量表示と警告**:
   - 50%以上: すべての回答の最後に使用率を表示 `（タスクリスト使用率：約〜%）`
   - 70%以上: `⚠️ 容量の70%を超えています。長い処理にご注意ください`
   - 80%以上: `⚠️ 容量が80%を超えています。簡潔な対話を心がけてください`
   - 85%以上: `🚨 警告：容量が85%を超えています。対話が切断されるリスクがあります`
   - 90%以上: 引き継ぎプロンプト自動生成
   - 95%以上: `⛔ 緊急警告` と共に処理中断、即時引き継ぎ

2. **効率的なリソース使用のルール**:
   - 企画・アイデア段階では最終成果物の生成は行わず、概念と方向性の議論に集中
   - 明示的な承認を得てから本番作業を開始
   - 大規模な成果物は段階的に進める
   - 各ステップでの確認と調整を前提とした進行
   - ステップバイステップを心がけ、返事を受けてから次の作業に移行
