# HANAZONO_CRITICAL_NOTES.md

## 最終更新: 2025-05-03

## 重要な発見・問題点

1. **メール通知機能の欠落** [重大: ★★★★★]
   - **状況**: 元々実装されていた天気予報連携と推奨設定を含むメール通知機能が現在のコードでは単純化され、日付情報のみの表示になっていた
   - **原因**: email_notifier.pyの`send_daily_report`関数内でレポート生成部分が「簡略化のため省略」と記載され実装されていない
   - **参考**: 元々のメール形式は天気予報、季節判定、推奨設定（充電電流・時間・SOC）を含む

2. **インバーター設定最適化ロジック** [重要: ★★★★☆]
   - 季節ごとの推奨設定：
     - 冬季(12-3月): 充電電流60A, 充電時間60分, SOC設定60% 
     - 春秋季(4-6月,10-11月): 充電電流50A, 充電時間45分, SOC設定45%
     - 夏季(7-9月): 充電電流35A, 充電時間30分, SOC設定35%

## 現在進行中の作業・優先事項

1. **メール通知機能の復元** [最優先: ★★★★★]
   - 天気予報データ取得モジュールの確認/再実装
   - 季節判定と推奨設定ロジックの確認/再実装
   - email_notifier.pyのsend_daily_report関数の完全実装

2. **プロジェクト管理の改善** [高優先: ★★★★☆]
   - Gitリポジトリの設定
   - README.md, CHANGELOG.mdの作成
   - 各モジュールの役割・依存関係のドキュメント化

## 引き継ぎ用コメント
バージョン管理と機能意図の記録が不十分で、重要機能が失われる問題が発生。このドキュメントを常に更新・参照して再発を防止する。

## 容量監視と自動引き継ぎプロンプト

対話の容量管理、効率的なリソース使用、スムーズな引き継ぎのための指示：

1. **容量表示と警告**:
   - 50%以上: すべての回答の最後に使用率を表示 `（タスクリスト使用率：約〜%）`
   - 70%以上: `⚠️ 容量の70%を超えています。長い処理にご注意ください`
   - 80%以上: `⚠️ 容量が80%を超えています。簡潔な対話を心がけてください`
   - 85%以上: `🚨 警告：容量が85%を超えています。対話が切断されるリスクがあります`
   - 90%以上: 引き継ぎプロンプト自動生成
   - 95%以上: `⛔ 緊急警告` と共に処理中断、即時引き継ぎ

2. **引き継ぎプロンプトの形式**:
v[番号]_[プロジェクト名]／引き継ぎプロンプト-[日付]
プロジェクト概要
[プロジェクトの詳細な説明]

現在の状況
[現在の進捗状況と直面している課題]

これまでの成果
[完了した作業や決定事項のリスト]

次のステップ
[今後の作業予定と方向性]

注意点と制約
[プロジェクト進行上の重要な考慮事項]

対話進行方法
企画・検討段階では、アイデアと構造の議論に集中
「これで進めてください」などの明示的な承認があるまで最終成果物は生成しない
実装段階に入る前に「では実際の作業に入りますか？」などで確認を取る
段階的に進め、各ステップで確認・調整を行う

3. **効率的なリソース使用のルール**:
- 企画・アイデア段階では最終成果物の生成は行わず、概念と方向性の議論に集中
- 明示的な承認を得てから本番作業を開始
- 大規模な成果物は段階的に進める
- 各ステップでの確認と調整を前提とした進行
- ステップバイステップを心がけ、返事を受けてから次の作業に移行

4. **リソース使用の透明性**:
- リソースを多く使用するタスク開始前には影響を事前に通知
- 複雑なタスクの場合は分割方法と予想されるリソース使用量を提案
