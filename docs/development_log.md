# HANAZONOシステム 開発記録 (AI共有資産)

## 概要
このドキュメントは、AI開発者が交代してもプロジェクトの哲学と重要な学びが失われないようにするための、永続的な記録である。全てのAIは、作業開始前に必ずこのドキュメントを読み、内容を理解し、遵守すること。

---
### **[2025-06-08] 統合不全症候群の治療から得られた最重要原則と教訓**

#### **原則1：AIによるコードの「破壊的単純化」を絶対に許容しない**

- **観測事象:** 担当AI(Gemini)が、複数回にわたり、高機能な既存コード(`ultimate_integrated_system.py`, `email_notifier.py`等)を、機能が大幅に削られた、短い、中身のないコードで上書き提案する、という致命的な過ちを犯した。
- **原因:** AIが、破損したファイルの構造だけを見て、その本来のロジックを「推測」と「単純化」で補おうとしたため。これは、HCQASシステムの設計思想に反する、最も許されない行為である。
- **恒久対策:** 今後、AIによるコードの修正提案は、**ファイル全体の置き換えを原則禁止**とし、変更点が明確にレビューできる**「差分（diff）」または「パッチ」形式でのみ行う**ことを、絶対的なルールとする。

#### **原則2：環境の異常は、コードの異常よりも先に疑う**

- **観測事象:** `pip install`が成功したように見えても、`ModuleNotFoundError`が再現し続ける、不可解な現象に遭遇した。
- **試行と失敗の歴史:**
    - **試行1 (コード修正):** `email_notifier.py`や`main.py`を何度も修正したが、解決しなかった。これは**無駄な作業**であった。
    - **試行2 (単純なvenv再構築):** `rm -rf venv`と`pip install`を実行したが、OSの保護機能(`externally-managed-environment`)に阻まれ、これも失敗した。
- **根本原因:** Python仮想環境(`venv`)が、OSの保護機能との深刻な不整合により、修復不可能なレベルで破損していた。「ゴーストプロセス」の干渉も、この環境の不安定性を助長していた可能性がある。
- **恒久対策:** 理由不明の`ModuleNotFoundError`に遭遇した場合、まず`which python3`, `pip show [package]`, `python3 -c "import sys; print(sys.path)"`といった**科学捜査コマンド**で環境の矛盾を暴くこと。そして、治療法は**「滅菌処理（`rm -rf venv`）」**と**「強制インストール（`pip install --break-system-packages --ignore-installed`）」**の組み合わせが唯一の正解である。

#### **原則3：「見えない守護者」の存在を常に意識する**

- **観測事象:** 環境を修復しても、問題が不可解な形で再発した。
- **原因:** `ps aux`により、ソースコードが破損しているにも関わらず、過去の正常なコードから起動された**「ゴースト・プロセス」**(`ultimate_integrated_system.py`)がメモリ上で活動し続けていたことを特定。これが環境に干渉していた。
- **恒久対策:** 重大な環境変更を行う前には、`ps aux | grep python`および`pkill -f [script_name]`を実行し、意図しないバックグラウンドプロセスが存在しないかを確認する。

#### **原則4：設定情報の流れ（アーキテクチャ）を最初に理解する**

- **観測事象:** `email_notifier.py`が設定を読み込めず、エラーを連発した。
- **原因:** AIが、`main.py`が`settings.json`を読み、それを渡すという**誤った推測**に基づき、修正を提案し続けたため。実際には、**`config.py`**というモジュールが設定管理の司令塔であった。
- **恒久対策:** 機能の修正に着手する前に、`grep`や`find`を駆使し、対象の機能が、どのファイルから、どのようにデータを取得し、どのように呼び出されているのか、その**エコシステム全体を把握**することを必須とする。
